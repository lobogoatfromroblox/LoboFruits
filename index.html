<script src="/socket.io/socket.io.js"></script><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blox Fruits - Login</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a3e, #2d1b69);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Tela de Login */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0f23, #1a1a3e, #2d1b69);
        }

        .login-container {
            background: rgba(0,0,0,0.9);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(255,215,0,0.3);
        }

        .login-title {
            font-size: 36px;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .login-subtitle {
            color: #ccc;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            color: #ffd700;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 2px solid #ffd700;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #4ade80;
            box-shadow: 0 0 10px rgba(74,222,128,0.3);
        }

        .form-input::placeholder {
            color: #999;
        }

        .btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            width: 100%;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,215,0,0.5);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #666, #888);
            color: white;
        }

        .switch-form {
            color: #4ade80;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 15px;
            display: inline-block;
        }

        .switch-form:hover {
            color: #ffd700;
        }

        /* Tela de Sala */
        .room-screen {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .room-container {
            background: rgba(0,0,0,0.9);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .room-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .room-card {
            background: linear-gradient(45deg, #2d1b69, #4a2c7a);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255,215,0,0.3);
        }

        .room-card h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .room-card p {
            color: #ccc;
            font-size: 14px;
        }

        /* Game Screen */
        .game-screen {
            display: none;
        }

        /* Header */
        .header {
            background: rgba(0,0,0,0.9);
            padding: 15px 30px;
            border-bottom: 3px solid #ffd700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 3px solid #fff;
        }

        /* Painéis */
        .panel {
            background: rgba(0,0,0,0.8);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            padding: 20px;
            min-height: calc(100vh - 100px);
        }

        /* Mapa e Batalha */
        .map-container {
            background: rgba(0,0,0,0.8);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .sea-btn {
            padding: 10px;
            font-size: 12px;
            opacity: 0.7;
            transition: all 0.3s;
        }

        .sea-btn.active {
            opacity: 1;
            box-shadow: 0 0 15px rgba(255,215,0,0.5);
        }

        .sea-btn:hover {
            opacity: 1;
        }

        .island-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .island-card {
            background: linear-gradient(45deg, #2d1b69, #4a2c7a);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .island-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255,215,0,0.3);
        }

        .island-card.selected {
            border-color: #4ade80;
            background: linear-gradient(45deg, #1f5f3f, #2d7a4f);
        }

        .island-card.locked {
            opacity: 0.5;
            border-color: #666;
            cursor: not-allowed;
        }

        .island-card.locked:hover {
            transform: none;
            box-shadow: none;
        }

        .battle-area {
            background: rgba(255,68,68,0.1);
            border: 2px solid #ff4444;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .enemy-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .enemy-card {
            background: rgba(255,255,255,0.1);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .enemy-card:hover {
            background: rgba(255,68,68,0.2);
            transform: scale(1.05);
        }

        /* Ações Principais */
        .main-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-card {
            background: linear-gradient(45deg, #2d1b69, #4a2c7a);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255,215,0,0.3);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #4ade80, #6ee7b7);
            color: #000;
        }

        /* Notificações */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px 20px;
            color: white;
            z-index: 1000;
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Scrollbar customizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 4px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(0,0,0,0.9);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #ffd700;
        }

        .logout-btn {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(255,68,68,0.3);
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-title">🏴‍☠️ BLOX FRUITS</div>
            <div class="login-subtitle">Entre na aventura pirata!</div>
            
            <!-- Formulário de Login -->
            <div id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">👤 Nome de Usuário</label>
                    <input type="text" id="loginUsername" class="form-input" placeholder="Digite seu nome de usuário" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">🔒 Senha</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Digite sua senha" required>
                </div>
                
                <button class="btn" onclick="login()">🚀 Entrar no Jogo</button>
                <button class="btn btn-secondary" onclick="showSignupForm()">📝 Criar Conta</button>
                
                <div class="switch-form" onclick="showSignupForm()">
                    Não tem conta? Cadastre-se aqui!
                </div>
            </div>
            
            <!-- Formulário de Cadastro -->
            <div id="signupForm" style="display: none;">
                <div class="form-group">
                    <label for="signupUsername">👤 Nome de Usuário</label>
                    <input type="text" id="signupUsername" class="form-input" placeholder="Escolha um nome de usuário" required>
                </div>
                
                <div class="form-group">
                    <label for="signupEmail">📧 Email</label>
                    <input type="email" id="signupEmail" class="form-input" placeholder="Digite seu email" required>
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">🔒 Senha</label>
                    <input type="password" id="signupPassword" class="form-input" placeholder="Crie uma senha forte" required>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">🔒 Confirmar Senha</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="Confirme sua senha" required>
                </div>
                
                <button class="btn" onclick="signup()">⚓ Criar Conta</button>
                <button class="btn btn-secondary" onclick="showLoginForm()">🔙 Voltar ao Login</button>
                
                <div class="switch-form" onclick="showLoginForm()">
                    Já tem conta? Faça login aqui!
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Seleção de Sala -->
    <div class="room-screen" id="roomScreen">
        <div class="room-container">
            <div class="login-title">🏴‍☠️ ESCOLHER MODO</div>
            <div class="login-subtitle">Como você quer jogar?</div>
            
            <div class="room-options">
                <div class="room-card" onclick="startSinglePlayer()">
                    <div style="font-size: 40px; margin-bottom: 15px;">👤</div>
                    <h3>Single Player</h3>
                    <p>Jogue sozinho e explore o mundo dos piratas</p>
                </div>
                
                <div class="room-card" onclick="showMultiplayerOptions()">
                    <div style="font-size: 40px; margin-bottom: 15px;">👥</div>
                    <h3>Multiplayer</h3>
                    <p>Jogue com amigos online</p>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <button class="logout-btn" onclick="logout()">🚪 Sair</button>
            </div>
        </div>
    </div>

    <!-- Tela do Jogo -->
    <div class="game-screen" id="gameScreen">
        <!-- Header -->
        <div class="header">
            <div class="player-info">
                <div class="player-avatar" id="playerAvatar">🏴‍☠️</div>
                <div>
                    <h2 id="playerName">Capitão Luffy</h2>
                    <div style="display: flex; gap: 15px; margin-top: 5px;">
                        <span>Nível <strong id="playerLevel">1</strong></span>
                        <span style="color: #4ade80;" id="currentSeaDisplay">First Sea</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 20px; align-items: center;">
                <div style="text-align: center;">
                    <div style="font-size: 20px;">💰</div>
                    <div><strong id="berries">50,000</strong></div>
                    <div style="font-size: 12px; color: #ccc;">Berries</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 20px;">🏆</div>
                    <div><strong id="bounty">0</strong></div>
                    <div style="font-size: 12px; color: #ccc;">Recompensa</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 20px;">⭐</div>
                    <div><strong id="fragments">0</strong></div>
                    <div style="font-size: 12px; color: #ccc;">Fragmentos</div>
                </div>
                <button class="logout-btn" onclick="logout()">🚪 Sair</button>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <!-- Painel Esquerdo - Mapa e Navegação -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Seletor de Sea -->
                <div class="panel">
                    <h2>🌊 Escolher Sea</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                        <button class="btn sea-btn active" onclick="selectSea('first')" id="firstSeaBtn">
                            <div style="font-size: 20px;">🌊</div>
                            <div>First Sea</div>
                        </button>
                        <button class="btn sea-btn" onclick="selectSea('second')" id="secondSeaBtn">
                            <div style="font-size: 20px;">🌀</div>
                            <div>Second Sea</div>
                        </button>
                        <button class="btn sea-btn" onclick="selectSea('third')" id="thirdSeaBtn">
                            <div style="font-size: 20px;">⚡</div>
                            <div>Third Sea</div>
                        </button>
                    </div>
                    <div style="text-align: center; color: #ccc; font-size: 12px;">
                        Sea Atual: <span id="currentSeaName" style="color: #ffd700;">First Sea</span>
                    </div>
                </div>

                <!-- Mapa das Ilhas -->
                <div class="panel">
                    <h2>🗺️ Ilhas Disponíveis</h2>
                    <div class="island-grid" id="islandGrid">
                        <!-- Ilhas serão carregadas aqui -->
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn" onclick="travelToSelectedIsland()">🚢 Viajar para Ilha</button>
                    </div>
                </div>

                <!-- Área de Batalha -->
                <div class="panel">
                    <h2>⚔️ Inimigos Próximos</h2>
                    <div class="battle-area" id="battleArea">
                        <div class="enemy-grid" id="enemyGrid">
                            <!-- Inimigos serão carregados aqui -->
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-danger" onclick="refreshEnemies()">🔄 Procurar Inimigos</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Painel Central - Atividades Principais -->
            <div class="panel">
                <h2>🏴‍☠️ Blox Fruits Dashboard</h2>
                
                <!-- Stats do Jogador -->
                <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #ffd700;">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; color: #4ade80;">💪</div>
                            <div style="font-size: 18px; font-weight: bold;" id="playerLevelDisplay">1</div>
                            <div style="font-size: 12px; color: #ccc;">Nível</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; color: #ffd700;">💰</div>
                            <div style="font-size: 18px; font-weight: bold;" id="berriesDisplay">50,000</div>
                            <div style="font-size: 12px; color: #ccc;">Berries</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; color: #ff4444;">🏆</div>
                            <div style="font-size: 18px; font-weight: bold;" id="bountyDisplay">0</div>
                            <div style="font-size: 12px; color: #ccc;">Recompensa</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; color: #8b5cf6;">⭐</div>
                            <div style="font-size: 18px; font-weight: bold;" id="fragmentsDisplay">0</div>
                            <div style="font-size: 12px; color: #ccc;">Fragmentos</div>
                        </div>
                    </div>
                </div>

                <!-- Ações Rápidas -->
                <div class="main-actions">
                    <div class="action-card" onclick="openSpinFruits()">
                        <div style="font-size: 40px; margin-bottom: 10px;">🎰</div>
                        <h3>Spin Fruits</h3>
                        <p>Girar por frutas</p>
                    </div>
                    
                    <div class="action-card" onclick="openShop()">
                        <div style="font-size: 40px; margin-bottom: 10px;">🏪</div>
                        <h3>Loja</h3>
                        <p>Comprar itens</p>
                    </div>
                    
                    <div class="action-card" onclick="openQuests()">
                        <div style="font-size: 40px; margin-bottom: 10px;">📜</div>
                        <h3>Missões</h3>
                        <p>Aceitar quests</p>
                    </div>
                    
                    <div class="action-card" onclick="openRaids()">
                        <div style="font-size: 40px; margin-bottom: 10px;">🌋</div>
                        <h3>Raids</h3>
                        <p>Desafios especiais</p>
                    </div>
                    
                    <div class="action-card" onclick="openInventory()">
                        <div style="font-size: 40px; margin-bottom: 10px;">🎒</div>
                        <h3>Inventário</h3>
                        <p>Seus itens</p>
                    </div>
                    
                    <div class="action-card" onclick="openStats()">
                        <div style="font-size: 40px; margin-bottom: 10px;">📊</div>
                        <h3>Atributos</h3>
                        <p>Distribuir pontos</p>
                    </div>
                </div>

                <!-- Progresso Atual -->
                <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 1px solid #4ade80;">
                    <h3 style="color: #4ade80; margin-bottom: 15px;">📈 Progresso Atual</h3>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>EXP para próximo nível</span>
                                <span id="expProgress">750/1000</span>
                            </div>
                            <div style="background: rgba(76,175,80,0.3); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="expBar" style="background: #4ade80; height: 100%; width: 75%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 10px;">
                            <div style="text-align: center;">
                                <div style="font-size: 16px; color: #ffd700;">🎯 Quest Ativa</div>
                                <div style="font-size: 14px;" id="activeQuest">Derrotar 5 Bandidos</div>
                                <div style="font-size: 12px; color: #ccc;" id="questProgress">3/5</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 16px; color: #8b5cf6;">🏝️ Localização</div>
                                <div style="font-size: 14px;" id="currentLocation">Ilha Inicial</div>
                                <div style="font-size: 12px; color: #ccc;">First Sea</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Painel Direito - Equipamentos e Status -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Equipamentos -->
                <div class="panel">
                    <h2>⚔️ Equipamentos</h2>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <!-- Akuma no Mi -->
                        <div>
                            <h4 style="color: #ffd700; margin-bottom: 8px;">🍎 Akuma no Mi</h4>
                            <div style="background: rgba(255,215,0,0.1); padding: 10px; border-radius: 8px; border: 1px solid #ffd700;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                    <span style="font-size: 20px;" id="currentDevilFruitEmoji">🤜</span>
                                    <span style="font-weight: bold;" id="currentDevilFruitName">Gomu Gomu no Mi</span>
                                </div>
                                <div style="font-size: 12px; color: #ccc;" id="currentDevilFruitType">Paramecia</div>
                            </div>
                            <button class="btn" onclick="showDevilFruitSelector()" style="width: 100%; margin-top: 8px; font-size: 12px;">
                                🔄 Trocar Fruta
                            </button>
                        </div>
                        
                        <!-- Arma -->
                        <div>
                            <h4 style="color: #ffd700; margin-bottom: 8px;">⚔️ Arma</h4>
                            <div style="background: rgba(255,215,0,0.1); padding: 10px; border-radius: 8px; border: 1px solid #ffd700;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 20px;" id="currentWeaponEmoji">👊</span>
                                    <span style="font-weight: bold;" id="currentWeaponName">Punhos</span>
                                </div>
                            </div>
                            <button class="btn" onclick="showWeaponSelector()" style="width: 100%; margin-top: 8px; font-size: 12px;">
                                🔄 Trocar Arma
                            </button>
                        </div>
                        
                        <!-- Estilo de Luta -->
                        <div>
                            <h4 style="color: #ffd700; margin-bottom: 8px;">🥊 Estilo de Luta</h4>
                            <div style="background: rgba(255,215,0,0.1); padding: 10px; border-radius: 8px; border: 1px solid #ffd700;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 20px;" id="currentFightingStyleEmoji">🥊</span>
                                    <span style="font-weight: bold;" id="currentFightingStyleName">Lutador</span>
                                </div>
                            </div>
                            <button class="btn" onclick="showFightingStyleSelector()" style="width: 100%; margin-top: 8px; font-size: 12px;">
                                🔄 Trocar Estilo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Status do Jogador -->
                <div class="panel">
                    <h2>📊 Status</h2>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- HP -->
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: #4ade80;">❤️ HP</span>
                                <span style="color: #4ade80;"><span id="currentHp">100</span>/<span id="maxHp">100</span></span>
                            </div>
                            <div style="background: rgba(76,175,80,0.3); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="hpBar" style="background: #4ade80; height: 100%; width: 100%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        
                        <!-- Energia -->
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: #ffd700;">⚡ Energia</span>
                                <span style="color: #ffd700;"><span id="currentEnergy">100</span>/<span id="maxEnergy">100</span></span>
                            </div>
                            <div style="background: rgba(255,215,0,0.3); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="energyBar" style="background: #ffd700; height: 100%; width: 100%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        
                        <!-- Atributos -->
                        <div style="margin-top: 10px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">💪 Atributos</h4>
                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 14px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>🗡️ Melee:</span>
                                    <span style="color: #4ade80;" id="meleeLevel">1</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>🍎 Devil Fruit:</span>
                                    <span style="color: #4ade80;" id="dfLevel">1</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>⚔️ Sword:</span>
                                    <span style="color: #4ade80;" id="swordLevel">1</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>🔫 Gun:</span>
                                    <span style="color: #4ade80;" id="gunLevel">1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Eventos e Notícias -->
                <div class="panel">
                    <h2>📰 Eventos</h2>
                    <div style="display: flex; flex-direction: column; gap: 10px; font-size: 14px;">
                        <div style="background: rgba(255,215,0,0.1); padding: 10px; border-radius: 8px; border-left: 4px solid #ffd700;">
                            <div style="font-weight: bold; color: #ffd700;">🎉 Evento Ativo</div>
                            <div style="color: #ccc; font-size: 12px;">2x EXP em batalhas</div>
                            <div style="color: #ccc; font-size: 11px;">Termina em: 2h 30m</div>
                        </div>
                        
                        <div style="background: rgba(76,175,80,0.1); padding: 10px; border-radius: 8px; border-left: 4px solid #4ade80;">
                            <div style="font-weight: bold; color: #4ade80;">🌟 Dica do Dia</div>
                            <div style="color: #ccc; font-size: 12px;">Use habilidades de diferentes tipos para maximizar o dano!</div>
                        </div>
                        
                        <div style="background: rgba(255,68,68,0.1); padding: 10px; border-radius: 8px; border-left: 4px solid #ff4444;">
                            <div style="font-weight: bold; color: #ff4444;">⚠️ Boss Spawn</div>
                            <div style="color: #ccc; font-size: 12px;">Gorilla King apareceu na Jungle!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="gameModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalContent">
                <!-- Conteúdo do modal será carregado aqui -->
            </div>
        </div>
    </div>

    <script>
        // Sistema de usuários (simulado - localStorage)
        let users = JSON.parse(localStorage.getItem('bloxFruitsUsers')) || {};
        let currentUser = null;

        // Dados do jogo
        let gameData = {
            currentPlayer: {
                id: 'player_' + Date.now(),
                name: 'Capitão Luffy',
                level: 1,
                berries: 50000,
                bounty: 0,
                fragments: 0,
                exp: 750,
                maxExp: 1000,
                hp: 100,
                maxHp: 100,
                energy: 100,
                maxEnergy: 100,
                currentSea: 'first',
                currentIsland: 'starter',
                selectedIsland: 'starter',
                devilFruit: 'gomu',
                weapon: 'fists',
                fightingStyle: 'brawler',
                stats: {
                    melee: 1,
                    devilFruit: 1,
                    sword: 1,
                    gun: 1
                },
                statPoints: 0,
                inventory: [],
                quests: []
            },
            seas: {
                first: {
                    name: 'First Sea',
                    emoji: '🌊',
                    unlocked: true,
                    islands: [
                        { id: 'starter', name: 'Ilha Inicial', emoji: '🏝️', level: 1, unlocked: true },
                        { id: 'jungle', name: 'Ilha Selva', emoji: '🌴', level: 5, unlocked: false },
                        { id: 'desert', name: 'Alabasta', emoji: '🏜️', level: 10, unlocked: false },
                        { id: 'sky', name: 'Skypiea', emoji: '☁️', level: 15, unlocked: false },
                        { id: 'water7', name: 'Water 7', emoji: '🌊', level: 20, unlocked: false },
                        { id: 'thriller', name: 'Thriller Bark', emoji: '🦇', level: 25, unlocked: false }
                    ]
                },
                second: {
                    name: 'Second Sea',
                    emoji: '🌀',
                    unlocked: false,
                    islands: [
                        { id: 'fishman', name: 'Ilha Tritão', emoji: '🐠', level: 30, unlocked: false },
                        { id: 'punk', name: 'Punk Hazard', emoji: '☢️', level: 35, unlocked: false },
                        { id: 'dressrosa', name: 'Dressrosa', emoji: '🌹', level: 40, unlocked: false },
                        { id: 'zou', name: 'Zou', emoji: '🐘', level: 45, unlocked: false },
                        { id: 'cake', name: 'Whole Cake', emoji: '🎂', level: 50, unlocked: false },
                        { id: 'wano', name: 'Wano', emoji: '🏯', level: 55, unlocked: false }
                    ]
                },
                third: {
                    name: 'Third Sea',
                    emoji: '⚡',
                    unlocked: false,
                    islands: [
                        { id: 'egghead', name: 'Egghead', emoji: '🥚', level: 60, unlocked: false },
                        { id: 'elbaf', name: 'Elbaf', emoji: '⚔️', level: 65, unlocked: false },
                        { id: 'lodestar', name: 'Lodestar', emoji: '⭐', level: 70, unlocked: false },
                        { id: 'laugh', name: 'Laugh Tale', emoji: '💎', level: 75, unlocked: false },
                        { id: 'mariejois', name: 'Marie Jois', emoji: '👑', level: 80, unlocked: false },
                        { id: 'final', name: 'Ilha Final', emoji: '🌟', level: 100, unlocked: false }
                    ]
                }
            },
            enemies: [
                { id: 1, name: 'Bandido Fraco', level: 1, hp: 100, reward: 50, emoji: '🔪' },
                { id: 2, name: 'Pirata Novato', level: 2, hp: 150, reward: 75, emoji: '🏴‍☠️' },
                { id: 3, name: 'Marinheiro', level: 3, hp: 200, reward: 100, emoji: '⚓' }
            ],
            devilFruits: {
                gomu: { 
                    name: 'Gomu Gomu no Mi', 
                    type: 'Paramecia', 
                    emoji: '🤜',
                    abilities: [
                        { name: 'Gomu Gomu no Pistol', damage: 25, energy: 15, emoji: '👊' },
                        { name: 'Gomu Gomu no Gatling', damage: 40, energy: 30, emoji: '💥' },
                        { name: 'Gear Second', damage: 60, energy: 50, emoji: '🔥' }
                    ]
                },
                bomb: { 
                    name: 'Bomb Bomb no Mi', 
                    type: 'Paramecia', 
                    emoji: '💣',
                    abilities: [
                        { name: 'Bomb Punch', damage: 30, energy: 18, emoji: '💣' },
                        { name: 'Explosion', damage: 45, energy: 32, emoji: '💥' },
                        { name: 'Big Bomb', damage: 70, energy: 55, emoji: '🧨' }
                    ]
                },
                suna: { 
                    name: 'Suna Suna no Mi', 
                    type: 'Logia', 
                    emoji: '🏜️',
                    abilities: [
                        { name: 'Sand Blade', damage: 28, energy: 16, emoji: '🗡️' },
                        { name: 'Desert Storm', damage: 42, energy: 30, emoji: '🌪️' },
                        { name: 'Ground Death', damage: 65, energy: 50, emoji: '💀' }
                    ]
                },
                mera: { 
                    name: 'Mera Mera no Mi', 
                    type: 'Logia', 
                    emoji: '🔥',
                    abilities: [
                        { name: 'Hiken', damage: 35, energy: 20, emoji: '🔥' },
                        { name: 'Dai Enkai', damage: 50, energy: 35, emoji: '💥' },
                        { name: 'Entei', damage: 80, energy: 60, emoji: '☄️' }
                    ]
                },
                hie: { 
                    name: 'Hie Hie no Mi', 
                    type: 'Logia', 
                    emoji: '❄️',
                    abilities: [
                        { name: 'Ice Saber', damage: 30, energy: 18, emoji: '🗡️' },
                        { name: 'Ice Age', damage: 45, energy: 32, emoji: '🧊' },
                        { name: 'Absolute Zero', damage: 75, energy: 55, emoji: '❄️' }
                    ]
                },
                goro: { 
                    name: 'Goro Goro no Mi', 
                    type: 'Logia', 
                    emoji: '⚡',
                    abilities: [
                        { name: 'Lightning Strike', damage: 40, energy: 25, emoji: '⚡' },
                        { name: 'Thunder Storm', damage: 60, energy: 40, emoji: '🌩️' },
                        { name: 'God Judgment', damage: 100, energy: 70, emoji: '⚡' }
                    ]
                },
                yami: { 
                    name: 'Yami Yami no Mi', 
                    type: 'Logia', 
                    emoji: '🌑',
                    abilities: [
                        { name: 'Dark Hole', damage: 45, energy: 30, emoji: '🌑' },
                        { name: 'Black Vortex', damage: 65, energy: 45, emoji: '🌀' },
                        { name: 'Liberation', damage: 90, energy: 65, emoji: '💀' }
                    ]
                },
                pika: { 
                    name: 'Pika Pika no Mi', 
                    type: 'Logia', 
                    emoji: '💡',
                    abilities: [
                        { name: 'Light Beam', damage: 50, energy: 35, emoji: '💡' },
                        { name: 'Light Speed Kick', damage: 75, energy: 50, emoji: '⚡' },
                        { name: 'Yasakani no Magatama', damage: 120, energy: 80, emoji: '✨' }
                    ]
                },
                doku: { 
                    name: 'Doku Doku no Mi', 
                    type: 'Paramecia', 
                    emoji: '☠️',
                    abilities: [
                        { name: 'Poison Gas', damage: 35, energy: 25, emoji: '☠️' },
                        { name: 'Venom Road', damage: 55, energy: 40, emoji: '🐍' },
                        { name: 'Hell Judgment', damage: 95, energy: 70, emoji: '💀' }
                    ]
                },
                magu: { 
                    name: 'Magu Magu no Mi', 
                    type: 'Logia', 
                    emoji: '🌋',
                    abilities: [
                        { name: 'Magma Fist', damage: 60, energy: 40, emoji: '🌋' },
                        { name: 'Meteor Volcano', damage: 85, energy: 60, emoji: '☄️' },
                        { name: 'Great Eruption', damage: 150, energy: 90, emoji: '🌋' }
                    ]
                }
            },
            weapons: {
                fists: { 
                    name: 'Punhos', 
                    damage: 15, 
                    emoji: '👊',
                    abilities: [
                        { name: 'Soco Direto', damage: 15, energy: 10, emoji: '👊' },
                        { name: 'Combo', damage: 25, energy: 20, emoji: '💥' }
                    ]
                },
                sword: { 
                    name: 'Espada', 
                    damage: 25, 
                    emoji: '⚔️',
                    abilities: [
                        { name: 'Corte Simples', damage: 25, energy: 12, emoji: '⚔️' },
                        { name: 'Tatsumaki', damage: 40, energy: 25, emoji: '🌪️' },
                        { name: 'Santoryu', damage: 65, energy: 45, emoji: '⚡' }
                    ]
                },
                gun: { 
                    name: 'Pistola', 
                    damage: 20, 
                    emoji: '🔫',
                    abilities: [
                        { name: 'Tiro Certeiro', damage: 20, energy: 8, emoji: '🔫' },
                        { name: 'Rajada', damage: 35, energy: 18, emoji: '💥' }
                    ]
                }
            },
            fightingStyles: {
                brawler: { 
                    name: 'Lutador', 
                    emoji: '🥊',
                    abilities: [
                        { name: 'Uppercut', damage: 20, energy: 15, emoji: '🥊' },
                        { name: 'Combo Devastador', damage: 35, energy: 28, emoji: '💢' }
                    ]
                },
                martial: { 
                    name: 'Artes Marciais', 
                    emoji: '🥋',
                    abilities: [
                        { name: 'Chute Giratório', damage: 22, energy: 16, emoji: '🦵' },
                        { name: 'Técnica Secreta', damage: 45, energy: 35, emoji: '⚡' }
                    ]
                },
                sniper: { 
                    name: 'Atirador', 
                    emoji: '🎯',
                    abilities: [
                        { name: 'Tiro de Precisão', damage: 28, energy: 12, emoji: '🎯' },
                        { name: 'Tiro Explosivo', damage: 50, energy: 30, emoji: '💥' }
                    ]
                }
            },
            currentBattle: null,
            battleLog: []
        };

        // Funções de Login/Signup
        function showSignupForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
        }

        function showLoginForm() {
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        function signup() {
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!username || !email || !password || !confirmPassword) {
                alert('❌ Preencha todos os campos!');
                return;
            }

            if (password !== confirmPassword) {
                alert('❌ As senhas não coincidem!');
                return;
            }

            if (users[username]) {
                alert('❌ Nome de usuário já existe!');
                return;
            }

            // Criar novo usuário
            users[username] = {
                username: username,
                email: email,
                password: password, // Em produção, use hash!
                createdAt: new Date().toISOString(),
                gameData: null
            };

            localStorage.setItem('bloxFruitsUsers', JSON.stringify(users));
            
            showNotification('✅ Conta criada com sucesso!');
            showLoginForm();
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                alert('❌ Preencha todos os campos!');
                return;
            }

            const user = users[username];
            if (!user || user.password !== password) {
                alert('❌ Usuário ou senha incorretos!');
                return;
            }

            currentUser = user;
            gameData.currentPlayer.name = username;
            
            // Carregar dados salvos do usuário
            if (user.gameData) {
                gameData = { ...gameData, ...user.gameData };
            }

            showNotification(`🎉 Bem-vindo, ${username}!`);
            showRoomScreen();
        }

        function logout() {
            // Salvar dados do jogo
            if (currentUser) {
                users[currentUser.username].gameData = gameData;
                localStorage.setItem('bloxFruitsUsers', JSON.stringify(users));
            }
            
            currentUser = null;
            showLoginScreen();
            showNotification('👋 Logout realizado com sucesso!');
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('roomScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
        }

        function showRoomScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('roomScreen').style.display = 'flex';
            document.getElementById('gameScreen').style.display = 'none';
        }

        function showGameScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('roomScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
        }

        function startSinglePlayer() {
            showGameScreen();
            initGame();
            showNotification('🏴‍☠️ Modo Single Player iniciado!');
        }

        function showMultiplayerOptions() {
            showModal(`
                <h2>👥 Opções Multiplayer</h2>
                <div style="margin-top: 20px;">
                    <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 2px solid #ffd700; margin-bottom: 20px;">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">🔑 Código da Sala</h3>
                        <input type="text" id="roomCode" class="form-input" placeholder="Digite o código da sala" style="margin-bottom: 15px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn" onclick="joinRoom()">🚪 Entrar na Sala</button>
                            <button class="btn btn-secondary" onclick="createRoom()">➕ Criar Sala</button>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,68,68,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ff4444; text-align: center;">
                        <h4 style="color: #ff4444; margin-bottom: 10px;">⚠️ Aviso</h4>
                        <p style="color: #ccc; font-size: 14px;">
                            Apenas administradores podem criar salas.<br>
                            Para jogar multiplayer, você precisa de um código de sala válido.
                        </p>
                    </div>
                </div>
            `);
        }

        function createRoom() {
            // Lista de administradores autorizados (VOCÊ PODE ADICIONAR SEU USERNAME AQUI)
            const admins = ['admin', 'luffy', 'zoro', 'naruto', 'goku', 'ichigo']; // ← ADICIONE SEU USERNAME AQUI
            
            if (!admins.includes(currentUser.username.toLowerCase())) {
                showNotification('❌ Apenas administradores podem criar salas!');
                showModal(`
                    <h2>🔒 Acesso Negado</h2>
                    <div style="margin-top: 20px; text-align: center;">
                        <div style="background: rgba(255,68,68,0.1); padding: 20px; border-radius: 15px; border: 2px solid #ff4444; margin-bottom: 20px;">
                            <h3 style="color: #ff4444; margin-bottom: 15px;">⚠️ Apenas Administradores</h3>
                            <p style="color: #ccc; line-height: 1.6;">
                                Somente usuários autorizados podem criar salas multiplayer.<br><br>
                                <strong>Administradores atuais:</strong><br>
                                ${admins.map(admin => `• ${admin}`).join('<br>')}
                            </p>
                        </div>
                        
                        <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">💡 Como se tornar Admin?</h4>
                            <p style="color: #ccc; font-size: 14px;">
                                Para se tornar administrador, você precisa:<br>
                                1. Ter acesso ao código fonte<br>
                                2. Adicionar seu username na lista de admins<br>
                                3. Ou solicitar acesso ao desenvolvedor
                            </p>
                        </div>
                    </div>
                `);
                return;
            }
            
            const roomCode = 'ROOM_' + Math.random().toString(36).substr(2, 6).toUpperCase();
            
            showModal(`
                <h2>🎉 Sala Criada!</h2>
                <div style="margin-top: 20px; text-align: center;">
                    <div style="background: rgba(76,175,80,0.1); padding: 20px; border-radius: 15px; border: 2px solid #4ade80; margin-bottom: 20px;">
                        <h3 style="color: #4ade80; margin-bottom: 15px;">🔑 Código da Sala</h3>
                        <div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; font-size: 24px; font-weight: bold; color: #ffd700; letter-spacing: 3px;">
                            ${roomCode}
                        </div>
                        <p style="color: #ccc; margin-top: 10px; font-size: 14px;">
                            Compartilhe este código com seus amigos!
                        </p>
                    </div>
                    
                    <button class="btn" onclick="startMultiplayerGame('${roomCode}')">🚀 Iniciar Jogo Multiplayer</button>
                </div>
            `);
        }

        function joinRoom() {
            const roomCode = document.getElementById('roomCode').value.trim();
            
            if (!roomCode) {
                showNotification('❌ Digite um código de sala!');
                return;
            }
            
            // Simular verificação de sala (em produção, verificar no servidor)
            if (roomCode.startsWith('ROOM_') && roomCode.length === 11) {
                startMultiplayerGame(roomCode);
            } else {
                showNotification('❌ Código de sala inválido!');
            }
        }

        function startMultiplayerGame(roomCode) {
            closeModal();
            showGameScreen();
            initGame();
            showNotification(`🌐 Conectado à sala: ${roomCode}`);
            
            // Adicionar indicador de multiplayer
            const header = document.querySelector('.header');
            const multiplayerIndicator = document.createElement('div');
            multiplayerIndicator.innerHTML = `
                <div style="background: rgba(76,175,80,0.2); padding: 8px 15px; border-radius: 20px; border: 1px solid #4ade80;">
                    <span style="color: #4ade80; font-size: 12px;">🌐 MULTIPLAYER</span>
                    <span style="color: #ccc; font-size: 11px;">Sala: ${roomCode}</span>
                </div>
            `;
            header.appendChild(multiplayerIndicator);
        }

        // Inicializar jogo
        function initGame() {
            loadIslands();
            loadEnemies();
            updateUI();
            updateSeaButtons();
            
            // Inicializar quest ativa
            gameData.currentPlayer.quests = [
                { id: 1, name: 'Derrotar 5 Bandidos', progress: 3, target: 5, reward: 500, active: true }
            ];
        }

        // Selecionar Sea
        function selectSea(seaId) {
            const sea = gameData.seas[seaId];
            
            if (!sea.unlocked) {
                showNotification(`🔒 ${sea.name} ainda não foi desbloqueado!`);
                return;
            }
            
            gameData.currentPlayer.currentSea = seaId;
            updateSeaButtons();
            loadIslands();
            
            document.getElementById('currentSeaName').textContent = sea.name;
            document.getElementById('currentSeaDisplay').textContent = sea.name;
            showNotification(`🌊 Navegando para ${sea.name}!`);
        }

        // Atualizar botões das seas
        function updateSeaButtons() {
            const seaButtons = document.querySelectorAll('.sea-btn');
            seaButtons.forEach(btn => btn.classList.remove('active'));
            
            const currentSeaBtn = document.getElementById(gameData.currentPlayer.currentSea + 'SeaBtn');
            if (currentSeaBtn) {
                currentSeaBtn.classList.add('active');
            }
            
            // Desabilitar seas bloqueadas
            Object.keys(gameData.seas).forEach(seaId => {
                const btn = document.getElementById(seaId + 'SeaBtn');
                const sea = gameData.seas[seaId];
                
                if (!sea.unlocked) {
                    btn.style.opacity = '0.3';
                    btn.style.cursor = 'not-allowed';
                } else {
                    btn.style.opacity = btn.classList.contains('active') ? '1' : '0.7';
                    btn.style.cursor = 'pointer';
                }
            });
        }

        // Carregar ilhas da sea atual
        function loadIslands() {
            const islandGrid = document.getElementById('islandGrid');
            islandGrid.innerHTML = '';
            
            const currentSea = gameData.seas[gameData.currentPlayer.currentSea];
            
            currentSea.islands.forEach(island => {
                const islandDiv = document.createElement('div');
                const isSelected = island.id === gameData.currentPlayer.selectedIsland;
                const isLocked = !island.unlocked;
                
                islandDiv.className = `island-card ${isSelected ? 'selected' : ''} ${isLocked ? 'locked' : ''}`;
                islandDiv.onclick = () => selectIsland(island);
                
                islandDiv.innerHTML = `
                    <div style="font-size: 25px; margin-bottom: 8px;">${island.emoji}</div>
                    <div style="font-weight: bold; font-size: 12px; margin-bottom: 5px;">${island.name}</div>
                    <div style="font-size: 10px; color: #ccc;">Nível Requerido: ${island.level}</div>
                    ${isLocked ? '<div style="font-size: 15px; margin-top: 5px; color: #ff4444;">🔒 Bloqueado</div>' : ''}
                    ${isSelected ? '<div style="font-size: 12px; margin-top: 5px; color: #4ade80;">📍 Selecionado</div>' : ''}
                `;
                
                islandGrid.appendChild(islandDiv);
            });
        }

        // Carregar inimigos
        function loadEnemies() {
            const enemyGrid = document.getElementById('enemyGrid');
            enemyGrid.innerHTML = '';
            
            gameData.enemies.forEach(enemy => {
                const enemyDiv = document.createElement('div');
                enemyDiv.className = 'enemy-card';
                enemyDiv.onclick = () => battleEnemy(enemy);
                
                enemyDiv.innerHTML = `
                    <div style="font-size: 25px; margin-bottom: 5px;">${enemy.emoji}</div>
                    <div style="font-weight: bold; font-size: 12px;">${enemy.name}</div>
                    <div style="font-size: 10px; color: #ccc;">Nível ${enemy.level}</div>
                    <div style="font-size: 10px; color: #ffd700;">💰 ${enemy.reward}</div>
                `;
                
                enemyGrid.appendChild(enemyDiv);
            });
        }

        // Selecionar ilha
        function selectIsland(island) {
            if (!island.unlocked) {
                showNotification(`🔒 ${island.name} está bloqueada! Você precisa ser nível ${island.level}.`);
                return;
            }
            
            gameData.currentPlayer.selectedIsland = island.id;
            loadIslands();
            showNotification(`📍 ${island.name} selecionada!`);
        }

        // Viajar para ilha selecionada
        function travelToSelectedIsland() {
            const currentSea = gameData.seas[gameData.currentPlayer.currentSea];
            const selectedIsland = currentSea.islands.find(i => i.id === gameData.currentPlayer.selectedIsland);
            
            if (!selectedIsland) {
                showNotification('❌ Selecione uma ilha primeiro!');
                return;
            }
            
            if (!selectedIsland.unlocked) {
                showNotification(`🔒 ${selectedIsland.name} ainda está bloqueada!`);
                return;
            }
            
            gameData.currentPlayer.currentIsland = selectedIsland.id;
            document.getElementById('currentLocation').textContent = selectedIsland.name;
            showNotification(`🚢 Viajando para ${selectedIsland.name}...`);
            
            // Gerar novos inimigos baseados na ilha
            generateIslandEnemies(selectedIsland);
        }

        // Iniciar batalha contra inimigo
        function battleEnemy(enemy) {
            if (gameData.currentBattle) {
                showNotification('❌ Você já está em batalha!');
                return;
            }
            
            // Criar cópia do inimigo para a batalha
            const battleEnemy = {
                ...enemy,
                maxHp: enemy.hp,
                currentHp: enemy.hp
            };
            
            gameData.currentBattle = {
                enemy: battleEnemy,
                turn: 'player',
                round: 1
            };
            
            gameData.battleLog = [];
            
            showBattleInterface();
            addBattleLog(`⚔️ Batalha iniciada contra ${enemy.name}!`);
            addBattleLog(`💪 Sua Akuma no Mi: ${gameData.devilFruits[gameData.currentPlayer.devilFruit].name}`);
            addBattleLog(`⚔️ Sua Arma: ${gameData.weapons[gameData.currentPlayer.weapon].name}`);
            addBattleLog(`🥊 Seu Estilo: ${gameData.fightingStyles[gameData.currentPlayer.fightingStyle].name}`);
        }

        // Mostrar interface de batalha
        function showBattleInterface() {
            const battleArea = document.getElementById('battleArea');
            battleArea.innerHTML = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <h3 style="color: #ff4444; margin-bottom: 10px;">⚔️ BATALHA EM ANDAMENTO</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                        <!-- Jogador -->
                        <div style="background: rgba(76,175,80,0.2); padding: 15px; border-radius: 10px; border: 2px solid #4ade80;">
                            <h4 style="color: #4ade80; margin-bottom: 10px;">👤 ${gameData.currentPlayer.name}</h4>
                            <div style="margin-bottom: 8px;">
                                <div style="background: rgba(76,175,80,0.3); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="playerHpBar" style="background: #4ade80; height: 100%; width: ${(gameData.currentPlayer.hp / gameData.currentPlayer.maxHp) * 100}%; transition: width 0.3s;"></div>
                                </div>
                                <div style="font-size: 12px; margin-top: 2px;">HP: ${gameData.currentPlayer.hp}/${gameData.currentPlayer.maxHp}</div>
                            </div>
                            <div style="margin-bottom: 8px;">
                                <div style="background: rgba(255,215,0,0.3); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div id="playerEnergyBar" style="background: #ffd700; height: 100%; width: ${(gameData.currentPlayer.energy / gameData.currentPlayer.maxEnergy) * 100}%; transition: width 0.3s;"></div>
                                </div>
                                <div style="font-size: 12px; margin-top: 2px;">Energia: ${gameData.currentPlayer.energy}/${gameData.currentPlayer.maxEnergy}</div>
                            </div>
                        </div>
                        
                        <!-- Inimigo -->
                        <div style="background: rgba(255,68,68,0.2); padding: 15px; border-radius: 10px; border: 2px solid #ff4444;">
                            <h4 style="color: #ff4444; margin-bottom: 10px;">${gameData.currentBattle.enemy.emoji} ${gameData.currentBattle.enemy.name}</h4>
                            <div style="margin-bottom: 8px;">
                                <div style="background: rgba(255,68,68,0.3); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="enemyHpBar" style="background: #ff4444; height: 100%; width: ${(gameData.currentBattle.enemy.currentHp / gameData.currentBattle.enemy.maxHp) * 100}%; transition: width 0.3s;"></div>
                                </div>
                                <div style="font-size: 12px; margin-top: 2px;">HP: ${gameData.currentBattle.enemy.currentHp}/${gameData.currentBattle.enemy.maxHp}</div>
                            </div>
                            <div style="font-size: 12px; color: #ccc;">Nível: ${gameData.currentBattle.enemy.level}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Log de Batalha -->
                <div style="background: rgba(0,0,0,0.5); border-radius: 8px; padding: 10px; margin-bottom: 15px; max-height: 120px; overflow-y: auto;" id="battleLogContainer">
                    <div id="battleLog"></div>
                </div>
                
                <!-- Ações de Batalha -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div>
                        <h5 style="color: #ffd700; margin-bottom: 8px; text-align: center;">🍎 Akuma no Mi</h5>
                        <div id="devilFruitAbilities"></div>
                    </div>
                    <div>
                        <h5 style="color: #ffd700; margin-bottom: 8px; text-align: center;">⚔️ Armas</h5>
                        <div id="weaponAbilities"></div>
                    </div>
                    <div>
                        <h5 style="color: #ffd700; margin-bottom: 8px; text-align: center;">🥊 Estilo de Luta</h5>
                        <div id="fightingStyleAbilities"></div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-danger" onclick="fleeBattle()">🏃 Fugir da Batalha</button>
                </div>
            `;
            
            loadBattleAbilities();
            updateBattleLog();
        }

        // Carregar habilidades de batalha
        function loadBattleAbilities() {
            const devilFruit = gameData.devilFruits[gameData.currentPlayer.devilFruit];
            const weapon = gameData.weapons[gameData.currentPlayer.weapon];
            const fightingStyle = gameData.fightingStyles[gameData.currentPlayer.fightingStyle];
            
            // Habilidades da Akuma no Mi
            const dfContainer = document.getElementById('devilFruitAbilities');
            dfContainer.innerHTML = '';
            devilFruit.abilities.forEach(ability => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.style.cssText = 'width: 100%; margin-bottom: 5px; font-size: 11px; padding: 8px;';
                btn.innerHTML = `${ability.emoji} ${ability.name}<br><span style="font-size: 9px;">Dano: ${ability.damage} | Energia: ${ability.energy}</span>`;
                btn.onclick = () => useAbility('devilFruit', ability);
                
                if (gameData.currentPlayer.energy < ability.energy) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
                
                dfContainer.appendChild(btn);
            });
            
            // Habilidades da Arma
            const weaponContainer = document.getElementById('weaponAbilities');
            weaponContainer.innerHTML = '';
            weapon.abilities.forEach(ability => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.style.cssText = 'width: 100%; margin-bottom: 5px; font-size: 11px; padding: 8px;';
                btn.innerHTML = `${ability.emoji} ${ability.name}<br><span style="font-size: 9px;">Dano: ${ability.damage} | Energia: ${ability.energy}</span>`;
                btn.onclick = () => useAbility('weapon', ability);
                
                if (gameData.currentPlayer.energy < ability.energy) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
                
                weaponContainer.appendChild(btn);
            });
            
            // Habilidades do Estilo de Luta
            const styleContainer = document.getElementById('fightingStyleAbilities');
            styleContainer.innerHTML = '';
            fightingStyle.abilities.forEach(ability => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.style.cssText = 'width: 100%; margin-bottom: 5px; font-size: 11px; padding: 8px;';
                btn.innerHTML = `${ability.emoji} ${ability.name}<br><span style="font-size: 9px;">Dano: ${ability.damage} | Energia: ${ability.energy}</span>`;
                btn.onclick = () => useAbility('fightingStyle', ability);
                
                if (gameData.currentPlayer.energy < ability.energy) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
                
                styleContainer.appendChild(btn);
            });
        }

        // Usar habilidade
        function useAbility(type, ability) {
            if (gameData.currentBattle.turn !== 'player') {
                showNotification('❌ Não é seu turno!');
                return;
            }
            
            if (gameData.currentPlayer.energy < ability.energy) {
                showNotification('❌ Energia insuficiente!');
                return;
            }
            
            // Consumir energia
            gameData.currentPlayer.energy -= ability.energy;
            
            // Calcular dano
            let damage = ability.damage;
            const critChance = 0.2; // 20% chance de crítico
            const isCrit = Math.random() < critChance;
            
            if (isCrit) {
                damage = Math.floor(damage * 1.5);
            }
            
            // Aplicar dano ao inimigo
            gameData.currentBattle.enemy.currentHp -= damage;
            
            addBattleLog(`${ability.emoji} Você usou ${ability.name}! ${isCrit ? 'CRÍTICO! ' : ''}Dano: ${damage}`);
            
            // Verificar se o inimigo morreu
            if (gameData.currentBattle.enemy.currentHp <= 0) {
                gameData.currentBattle.enemy.currentHp = 0;
                endBattle(true);
                return;
            }
            
            // Turno do inimigo
            gameData.currentBattle.turn = 'enemy';
            updateBattleInterface();
            
            setTimeout(() => {
                enemyTurn();
            }, 1500);
        }

        // Turno do inimigo
        function enemyTurn() {
            const enemy = gameData.currentBattle.enemy;
            const enemyDamage = Math.floor(Math.random() * 30) + enemy.level * 5;
            
            gameData.currentPlayer.hp -= enemyDamage;
            
            addBattleLog(`💥 ${enemy.name} atacou você! Dano: ${enemyDamage}`);
            
            // Verificar se o jogador morreu
            if (gameData.currentPlayer.hp <= 0) {
                gameData.currentPlayer.hp = 0;
                endBattle(false);
                return;
            }
            
            // Regenerar energia do jogador
            gameData.currentPlayer.energy = Math.min(gameData.currentPlayer.maxEnergy, gameData.currentPlayer.energy + 20);
            
            // Próximo turno
            gameData.currentBattle.turn = 'player';
            gameData.currentBattle.round++;
            
            updateBattleInterface();
            loadBattleAbilities();
        }

        // Finalizar batalha - CORRIGIDO COMPLETAMENTE
        function endBattle(victory) {
            const enemy = gameData.currentBattle.enemy;
            
            if (victory) {
                const reward = enemy.reward;
                const expGain = enemy.level * 20;
                
                gameData.currentPlayer.berries += reward;
                gameData.currentPlayer.bounty += enemy.level * 10;
                gameData.currentPlayer.exp += expGain;
                
                addBattleLog(`🎉 VITÓRIA! +${reward} berries, +${expGain} EXP`);
                addBattleLog(`✨ Batalha finalizada! Retornando ao mapa...`);
                
                // Verificar level up
                if (gameData.currentPlayer.exp >= gameData.currentPlayer.maxExp) {
                    levelUp();
                }
                
                // Atualizar quest
                updateQuest('defeat_enemies', 1);
                
                showNotification(`⚔️ Vitória contra ${enemy.name}! Interface resetando...`);
            } else {
                addBattleLog(`💀 DERROTA! Você foi derrotado por ${enemy.name}...`);
                addBattleLog(`💊 Recuperando e retornando ao mapa...`);
                showNotification(`💥 Você foi derrotado por ${enemy.name}!`);
                
                // Penalidade por derrota
                gameData.currentPlayer.berries = Math.max(0, gameData.currentPlayer.berries - 100);
            }
            
            // RESETAR IMEDIATAMENTE após 2 segundos
            setTimeout(() => {
                // Restaurar stats do jogador
                gameData.currentPlayer.hp = gameData.currentPlayer.maxHp;
                gameData.currentPlayer.energy = gameData.currentPlayer.maxEnergy;
                
                // Limpar batalha atual
                gameData.currentBattle = null;
                gameData.battleLog = [];
                
                // FORÇAR RESET COMPLETO DA INTERFACE
                resetBattleInterface();
                updateUI();
                
                showNotification('🔄 Interface de batalha resetada!');
            }, 2000);
        }

        // FUNÇÃO MELHORADA: Resetar interface de batalha
        function resetBattleInterface() {
            const battleArea = document.getElementById('battleArea');
            
            // LIMPAR COMPLETAMENTE e recriar do zero
            battleArea.innerHTML = '';
            
            // Recriar estrutura original
            battleArea.innerHTML = `
                <div class="enemy-grid" id="enemyGrid">
                    <!-- Inimigos serão carregados aqui -->
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-danger" onclick="refreshEnemies()">🔄 Procurar Inimigos</button>
                </div>
            `;
            
            // Recarregar inimigos
            loadEnemies();
            
            console.log('✅ Interface de batalha resetada completamente');
        }

        // Level Up
        function levelUp() {
            gameData.currentPlayer.level++;
            gameData.currentPlayer.exp -= gameData.currentPlayer.maxExp;
            gameData.currentPlayer.maxExp = Math.floor(gameData.currentPlayer.maxExp * 1.2);
            gameData.currentPlayer.maxHp += 20;
            gameData.currentPlayer.maxEnergy += 10;
            gameData.currentPlayer.statPoints += 3;
            
            addBattleLog(`⭐ LEVEL UP! Agora você é nível ${gameData.currentPlayer.level}!`);
            showNotification(`🎉 Level Up! Nível ${gameData.currentPlayer.level}! +3 pontos de atributo!`);
            
            unlockNewContent();
        }

        // Atualizar quest
        function updateQuest(type, amount) {
            const activeQuest = gameData.currentPlayer.quests.find(q => q.active);
            if (activeQuest && type === 'defeat_enemies') {
                activeQuest.progress = Math.min(activeQuest.target, activeQuest.progress + amount);
                
                if (activeQuest.progress >= activeQuest.target) {
                    // Quest completa
                    gameData.currentPlayer.berries += activeQuest.reward;
                    showNotification(`✅ Quest completa! +${activeQuest.reward} berries!`);
                    activeQuest.active = false;
                    
                    // Nova quest
                    gameData.currentPlayer.quests.push({
                        id: 2,
                        name: 'Derrotar 10 Piratas',
                        progress: 0,
                        target: 10,
                        reward: 1000,
                        active: true
                    });
                }
                
                updateUI();
            }
        }

        // Fugir da batalha
        function fleeBattle() {
            addBattleLog(`🏃 Você fugiu da batalha!`);
            showNotification('🏃 Você fugiu da batalha!');
            
            gameData.currentBattle = null;
            resetBattleInterface();
        }

        // Adicionar ao log de batalha
        function addBattleLog(message) {
            gameData.battleLog.push({
                message: message,
                timestamp: Date.now()
            });
            updateBattleLog();
        }

        // Atualizar log de batalha
        function updateBattleLog() {
            const battleLog = document.getElementById('battleLog');
            if (!battleLog) return;
            
            battleLog.innerHTML = '';
            gameData.battleLog.slice(-8).forEach(entry => {
                const logDiv = document.createElement('div');
                logDiv.style.cssText = 'margin-bottom: 3px; font-size: 12px; padding: 2px;';
                logDiv.textContent = entry.message;
                battleLog.appendChild(logDiv);
            });
            
            battleLog.scrollTop = battleLog.scrollHeight;
        }

        // Atualizar interface de batalha
        function updateBattleInterface() {
            const playerHpBar = document.getElementById('playerHpBar');
            const playerEnergyBar = document.getElementById('playerEnergyBar');
            const enemyHpBar = document.getElementById('enemyHpBar');
            
            if (playerHpBar) {
                playerHpBar.style.width = `${(gameData.currentPlayer.hp / gameData.currentPlayer.maxHp) * 100}%`;
                playerHpBar.parentElement.nextElementSibling.textContent = `HP: ${gameData.currentPlayer.hp}/${gameData.currentPlayer.maxHp}`;
            }
            
            if (playerEnergyBar) {
                playerEnergyBar.style.width = `${(gameData.currentPlayer.energy / gameData.currentPlayer.maxEnergy) * 100}%`;
                playerEnergyBar.parentElement.nextElementSibling.textContent = `Energia: ${gameData.currentPlayer.energy}/${gameData.currentPlayer.maxEnergy}`;
            }
            
            if (enemyHpBar && gameData.currentBattle) {
                enemyHpBar.style.width = `${(gameData.currentBattle.enemy.currentHp / gameData.currentBattle.enemy.maxHp) * 100}%`;
                enemyHpBar.parentElement.nextElementSibling.textContent = `HP: ${gameData.currentBattle.enemy.currentHp}/${gameData.currentBattle.enemy.maxHp}`;
            }
        }

        // Gerar inimigos baseados na ilha
        function generateIslandEnemies(island) {
            const enemyTypes = {
                'starter': [
                    { name: 'Bandido Local', emoji: '🔪', level: 1 },
                    { name: 'Pirata Novato', emoji: '🏴‍☠️', level: 2 }
                ],
                'jungle': [
                    { name: 'Gorila Selvagem', emoji: '🦍', level: 5 },
                    { name: 'Caçador da Selva', emoji: '🏹', level: 6 }
                ],
                'desert': [
                    { name: 'Crocodilo', emoji: '🐊', level: 10 },
                    { name: 'Rebelde de Alabasta', emoji: '🗡️', level: 11 }
                ],
                'sky': [
                    { name: 'Guerreiro Shandiano', emoji: '⚡', level: 15 },
                    { name: 'Soldado Divino', emoji: '👼', level: 16 }
                ]
            };
            
            const islandEnemies = enemyTypes[island.id] || [
                { name: 'Inimigo Genérico', emoji: '👹', level: island.level }
            ];
            
            gameData.enemies = [];
            for (let i = 0; i < 6; i++) {
                const enemyType = islandEnemies[Math.floor(Math.random() * islandEnemies.length)];
                const levelVariation = Math.floor(Math.random() * 3);
                const finalLevel = enemyType.level + levelVariation;
                
                gameData.enemies.push({
                    id: i + 1,
                    name: enemyType.name,
                    level: finalLevel,
                    hp: finalLevel * 50,
                    reward: finalLevel * 25,
                    emoji: enemyType.emoji
                });
            }
            
            loadEnemies();
        }

        // Desbloquear novas ilhas e seas
        function unlockNewContent() {
            const playerLevel = gameData.currentPlayer.level;
            
            // Desbloquear ilhas
            Object.values(gameData.seas).forEach(sea => {
                sea.islands.forEach(island => {
                    if (island.level <= playerLevel) {
                        island.unlocked = true;
                    }
                });
            });
            
            // Desbloquear seas
            if (playerLevel >= 30) {
                gameData.seas.second.unlocked = true;
            }
            if (playerLevel >= 60) {
                gameData.seas.third.unlocked = true;
            }
            
            loadIslands();
            updateSeaButtons();
        }

        // Atualizar interface
        function updateUI() {
            // Header
            document.getElementById('playerLevel').textContent = gameData.currentPlayer.level;
            document.getElementById('berries').textContent = gameData.currentPlayer.berries.toLocaleString();
            document.getElementById('bounty').textContent = gameData.currentPlayer.bounty.toLocaleString();
            document.getElementById('fragments').textContent = gameData.currentPlayer.fragments.toLocaleString();
            
            // Dashboard central
            document.getElementById('playerLevelDisplay').textContent = gameData.currentPlayer.level;
            document.getElementById('berriesDisplay').textContent = gameData.currentPlayer.berries.toLocaleString();
            document.getElementById('bountyDisplay').textContent = gameData.currentPlayer.bounty.toLocaleString();
            document.getElementById('fragmentsDisplay').textContent = gameData.currentPlayer.fragments.toLocaleString();
            
            // Progresso EXP
            document.getElementById('expProgress').textContent = `${gameData.currentPlayer.exp}/${gameData.currentPlayer.maxExp}`;
            document.getElementById('expBar').style.width = `${(gameData.currentPlayer.exp / gameData.currentPlayer.maxExp) * 100}%`;
            
            // Quest ativa
            const activeQuest = gameData.currentPlayer.quests.find(q => q.active);
            if (activeQuest) {
                document.getElementById('activeQuest').textContent = activeQuest.name;
                document.getElementById('questProgress').textContent = `${activeQuest.progress}/${activeQuest.target}`;
            }
            
            // Status de HP e Energia
            document.getElementById('currentHp').textContent = gameData.currentPlayer.hp;
            document.getElementById('maxHp').textContent = gameData.currentPlayer.maxHp;
            document.getElementById('currentEnergy').textContent = gameData.currentPlayer.energy;
            document.getElementById('maxEnergy').textContent = gameData.currentPlayer.maxEnergy;
            
            // Barras de HP e Energia
            document.getElementById('hpBar').style.width = `${(gameData.currentPlayer.hp / gameData.currentPlayer.maxHp) * 100}%`;
            document.getElementById('energyBar').style.width = `${(gameData.currentPlayer.energy / gameData.currentPlayer.maxEnergy) * 100}%`;
            
            // Atributos
            document.getElementById('meleeLevel').textContent = gameData.currentPlayer.stats.melee;
            document.getElementById('dfLevel').textContent = gameData.currentPlayer.stats.devilFruit;
            document.getElementById('swordLevel').textContent = gameData.currentPlayer.stats.sword;
            document.getElementById('gunLevel').textContent = gameData.currentPlayer.stats.gun;
            
            // Atualizar equipamentos
            updateEquipmentDisplay();
        }

        // Atualizar display dos equipamentos
        function updateEquipmentDisplay() {
            const devilFruit = gameData.devilFruits[gameData.currentPlayer.devilFruit];
            const weapon = gameData.weapons[gameData.currentPlayer.weapon];
            const fightingStyle = gameData.fightingStyles[gameData.currentPlayer.fightingStyle];
            
            document.getElementById('currentDevilFruitEmoji').textContent = devilFruit.emoji;
            document.getElementById('currentDevilFruitName').textContent = devilFruit.name;
            document.getElementById('currentDevilFruitType').textContent = devilFruit.type;
            
            document.getElementById('currentWeaponEmoji').textContent = weapon.emoji;
            document.getElementById('currentWeaponName').textContent = weapon.name;
            
            document.getElementById('currentFightingStyleEmoji').textContent = fightingStyle.emoji;
            document.getElementById('currentFightingStyleName').textContent = fightingStyle.name;
        }

        // Mostrar seletor de Akuma no Mi
        function showDevilFruitSelector() {
            let options = 'Escolha sua Akuma no Mi:\n\n';
            Object.keys(gameData.devilFruits).forEach((key, index) => {
                const fruit = gameData.devilFruits[key];
                options += `${index + 1}. ${fruit.emoji} ${fruit.name} (${fruit.type})\n`;
            });
            
            const choice = prompt(options + '\nDigite o número da fruta desejada:');
            const fruitKeys = Object.keys(gameData.devilFruits);
            const selectedIndex = parseInt(choice) - 1;
            
            if (selectedIndex >= 0 && selectedIndex < fruitKeys.length) {
                gameData.currentPlayer.devilFruit = fruitKeys[selectedIndex];
                updateEquipmentDisplay();
                showNotification(`🍎 Akuma no Mi trocada para ${gameData.devilFruits[fruitKeys[selectedIndex]].name}!`);
            }
        }

        // Mostrar seletor de armas
        function showWeaponSelector() {
            let options = 'Escolha sua arma:\n\n';
            Object.keys(gameData.weapons).forEach((key, index) => {
                const weapon = gameData.weapons[key];
                options += `${index + 1}. ${weapon.emoji} ${weapon.name}\n`;
            });
            
            const choice = prompt(options + '\nDigite o número da arma desejada:');
            const weaponKeys = Object.keys(gameData.weapons);
            const selectedIndex = parseInt(choice) - 1;
            
            if (selectedIndex >= 0 && selectedIndex < weaponKeys.length) {
                gameData.currentPlayer.weapon = weaponKeys[selectedIndex];
                updateEquipmentDisplay();
                showNotification(`⚔️ Arma trocada para ${gameData.weapons[weaponKeys[selectedIndex]].name}!`);
            }
        }

        // Mostrar seletor de estilo de luta
        function showFightingStyleSelector() {
            let options = 'Escolha seu estilo de luta:\n\n';
            Object.keys(gameData.fightingStyles).forEach((key, index) => {
                const style = gameData.fightingStyles[key];
                options += `${index + 1}. ${style.emoji} ${style.name}\n`;
            });
            
            const choice = prompt(options + '\nDigite o número do estilo desejado:');
            const styleKeys = Object.keys(gameData.fightingStyles);
            const selectedIndex = parseInt(choice) - 1;
            
            if (selectedIndex >= 0 && selectedIndex < styleKeys.length) {
                gameData.currentPlayer.fightingStyle = styleKeys[selectedIndex];
                updateEquipmentDisplay();
                showNotification(`🥊 Estilo de luta trocado para ${gameData.fightingStyles[styleKeys[selectedIndex]].name}!`);
            }
        }

        // Abrir modais das funcionalidades
        function openShop() {
            showModal(`
                <h2>🏪 Loja de Itens</h2>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h3>⚔️ Espada Katana</h3>
                        <p>Arma corpo a corpo</p>
                        <p style="color: #ffd700;">💰 25,000 Berries</p>
                        <button class="btn" onclick="buyItem('sword', 25000)">Comprar</button>
                    </div>
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h3>🔫 Pistola</h3>
                        <p>Arma de longo alcance</p>
                        <p style="color: #ffd700;">💰 15,000 Berries</p>
                        <button class="btn" onclick="buyItem('gun', 15000)">Comprar</button>
                    </div>
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h3>💊 Poção de Vida</h3>
                        <p>Restaura 50 HP</p>
                        <p style="color: #ffd700;">💰 500 Berries</p>
                        <button class="btn" onclick="buyItem('healthPotion', 500)">Comprar</button>
                    </div>
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h3>⚡ Poção de Energia</h3>
                        <p>Restaura 30 Energia</p>
                        <p style="color: #ffd700;">💰 300 Berries</p>
                        <button class="btn" onclick="buyItem('energyPotion', 300)">Comprar</button>
                    </div>
                </div>
                
                <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 1px solid #4ade80; margin-top: 20px; text-align: center;">
                    <h4 style="color: #4ade80; margin-bottom: 10px;">🎰 Quer Akuma no Mi?</h4>
                    <p style="color: #ccc; font-size: 14px; margin-bottom: 15px;">
                        Use o Spin Fruits para conseguir frutas incríveis!
                    </p>
                    <button class="btn" onclick="closeModal(); openSpinFruits();">🎰 Ir para Spin Fruits</button>
                </div>
            `);
        }

        function openQuests() {
            const activeQuest = gameData.currentPlayer.quests.find(q => q.active);
            showModal(`
                <h2>📜 Missões Disponíveis</h2>
                <div style="margin-top: 20px;">
                    <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 1px solid #4ade80; margin-bottom: 15px;">
                        <h3 style="color: #4ade80;">🎯 Quest Ativa</h3>
                        <p><strong>${activeQuest ? activeQuest.name : 'Nenhuma quest ativa'}</strong></p>
                        ${activeQuest ? `
                            <p>Progresso: ${activeQuest.progress}/${activeQuest.target}</p>
                            <p>Recompensa: ${activeQuest.reward} Berries</p>
                        ` : ''}
                    </div>
                    
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h3>📋 Próximas Quests</h3>
                        <div style="margin-top: 10px;">
                            <p>• Explorar 3 ilhas diferentes</p>
                            <p>• Derrotar um boss</p>
                            <p>• Alcançar nível 10</p>
                            <p>• Coletar 100,000 Berries</p>
                        </div>
                    </div>
                </div>
            `);
        }

        function openRaids() {
            const playerTokens = gameData.currentPlayer.raidTokens || 0;
            const playerLevel = gameData.currentPlayer.level;
            
            showModal(`
                <h2>🌋 Sistema de Raids</h2>
                <div style="margin-top: 20px; max-height: 70vh; overflow-y: auto;">
                    <!-- Status do Jogador -->
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700; margin-bottom: 20px; text-align: center;">
                        <h3 style="color: #ffd700; margin-bottom: 10px;">👤 Seu Status de Raid</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div>
                                <div style="font-size: 20px;">🏆</div>
                                <div style="font-weight: bold;">${playerTokens}</div>
                                <div style="font-size: 12px; color: #ccc;">Tokens de Raid</div>
                            </div>
                            <div>
                                <div style="font-size: 20px;">💪</div>
                                <div style="font-weight: bold;">${playerLevel}</div>
                                <div style="font-size: 12px; color: #ccc;">Nível</div>
                            </div>
                            <div>
                                <div style="font-size: 20px;">🎯</div>
                                <div style="font-weight: bold;">${gameData.currentPlayer.raidsCompleted || 0}</div>
                                <div style="font-size: 12px; color: #ccc;">Raids Completas</div>
                            </div>
                        </div>
                    </div>

                    <!-- Raids Disponíveis -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                        <!-- Raid Fácil -->
                        <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 2px solid #4ade80;">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 40px;">🦍</div>
                                <h3 style="color: #4ade80;">Gorilla King</h3>
                                <div style="font-size: 12px; color: #ccc;">Nível Requerido: 5</div>
                                <div style="font-size: 12px; color: #ffd700;">Custo: 1 Token</div>
                            </div>
                            <div style="font-size: 12px; margin-bottom: 15px;">
                                <p><strong>Recompensas:</strong></p>
                                <p>• 1,000-2,000 Berries</p>
                                <p>• 50-100 Fragmentos</p>
                                <p>• Chance de arma rara</p>
                            </div>
                            <button class="btn ${playerLevel < 5 || playerTokens < 1 ? 'disabled' : ''}" 
                                    onclick="startRaid('gorilla')" 
                                    ${playerLevel < 5 || playerTokens < 1 ? 'disabled' : ''}>
                                🚀 Iniciar Raid
                            </button>
                        </div>

                        <!-- Raid Médio -->
                        <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 2px solid #ffd700;">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 40px;">🐉</div>
                                <h3 style="color: #ffd700;">Sea Dragon</h3>
                                <div style="font-size: 12px; color: #ccc;">Nível Requerido: 15</div>
                                <div style="font-size: 12px; color: #ffd700;">Custo: 2 Tokens</div>
                            </div>
                            <div style="font-size: 12px; margin-bottom: 15px;">
                                <p><strong>Recompensas:</strong></p>
                                <p>• 3,000-5,000 Berries</p>
                                <p>• 100-200 Fragmentos</p>
                                <p>• Chance de fruta rara</p>
                            </div>
                            <button class="btn ${playerLevel < 15 || playerTokens < 2 ? 'disabled' : ''}" 
                                    onclick="startRaid('dragon')" 
                                    ${playerLevel < 15 || playerTokens < 2 ? 'disabled' : ''}>
                                🚀 Iniciar Raid
                            </button>
                        </div>

                        <!-- Raid Difícil -->
                        <div style="background: rgba(139,92,246,0.1); padding: 15px; border-radius: 10px; border: 2px solid #8b5cf6;">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 40px;">👹</div>
                                <h3 style="color: #8b5cf6;">Demon Lord</h3>
                                <div style="font-size: 12px; color: #ccc;">Nível Requerido: 25</div>
                                <div style="font-size: 12px; color: #ffd700;">Custo: 3 Tokens</div>
                            </div>
                            <div style="font-size: 12px; margin-bottom: 15px;">
                                <p><strong>Recompensas:</strong></p>
                                <p>• 5,000-10,000 Berries</p>
                                <p>• 200-400 Fragmentos</p>
                                <p>• Chance de fruta lendária</p>
                            </div>
                            <button class="btn ${playerLevel < 25 || playerTokens < 3 ? 'disabled' : ''}" 
                                    onclick="startRaid('demon')" 
                                    ${playerLevel < 25 || playerTokens < 3 ? 'disabled' : ''}>
                                🚀 Iniciar Raid
                            </button>
                        </div>

                        <!-- Raid Extremo -->
                        <div style="background: rgba(255,68,68,0.1); padding: 15px; border-radius: 10px; border: 2px solid #ff4444;">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 40px;">💀</div>
                                <h3 style="color: #ff4444;">Death Emperor</h3>
                                <div style="font-size: 12px; color: #ccc;">Nível Requerido: 50</div>
                                <div style="font-size: 12px; color: #ffd700;">Custo: 5 Tokens</div>
                            </div>
                            <div style="font-size: 12px; margin-bottom: 15px;">
                                <p><strong>Recompensas:</strong></p>
                                <p>• 10,000-20,000 Berries</p>
                                <p>• 500-1,000 Fragmentos</p>
                                <p>• Chance de fruta mítica</p>
                            </div>
                            <button class="btn ${playerLevel < 50 || playerTokens < 5 ? 'disabled' : ''}" 
                                    onclick="startRaid('emperor')" 
                                    ${playerLevel < 50 || playerTokens < 5 ? 'disabled' : ''}>
                                🚀 Iniciar Raid
                            </button>
                        </div>
                    </div>

                    <!-- Como conseguir tokens -->
                    <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 1px solid #4ade80; margin-bottom: 15px;">
                        <h4 style="color: #4ade80; margin-bottom: 10px;">💡 Como conseguir Tokens de Raid?</h4>
                        <div style="font-size: 14px; color: #ccc;">
                            <p>• Derrote 10 inimigos = 1 Token</p>
                            <p>• Complete quests = 1-2 Tokens</p>
                            <p>• Level up = 1 Token</p>
                            <p>• Compre na loja por 5,000 Berries</p>
                        </div>
                        <button class="btn" onclick="buyRaidToken()" style="margin-top: 10px; width: 100%;">
                            💰 Comprar Token (5,000 Berries)
                        </button>
                    </div>

                    <!-- Ranking de Raids -->
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h4 style="color: #ffd700; margin-bottom: 10px;">🏆 Top Raid Players</h4>
                        <div style="font-size: 12px;">
                            <div style="display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #333;">
                                <span>1. ${gameData.currentPlayer.name}</span>
                                <span>${gameData.currentPlayer.raidsCompleted || 0} raids</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #333;">
                                <span>2. Monkey D. Luffy</span>
                                <span>47 raids</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #333;">
                                <span>3. Roronoa Zoro</span>
                                <span>42 raids</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px;">
                                <span>4. Sanji</span>
                                <span>38 raids</span>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        function openInventory() {
            const inventory = gameData.currentPlayer.inventory || [];
            
            let inventoryHTML = '';
            
            // Separar itens por categoria
            const devilFruits = inventory.filter(item => item.type === 'devilFruit');
            const weapons = inventory.filter(item => item.type === 'weapon');
            const consumables = inventory.filter(item => item.type === 'consumable');
            const materials = inventory.filter(item => item.type === 'material');
            
            showModal(`
                <h2>🎒 Inventário Completo</h2>
                <div style="margin-top: 20px; max-height: 70vh; overflow-y: auto;">
                    <!-- Recursos -->
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700; margin-bottom: 15px;">
                        <h3>💰 Recursos</h3>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px;">💰</div>
                                <div>${gameData.currentPlayer.berries.toLocaleString()}</div>
                                <div style="font-size: 12px; color: #ccc;">Berries</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px;">⭐</div>
                                <div>${gameData.currentPlayer.fragments.toLocaleString()}</div>
                                <div style="font-size: 12px; color: #ccc;">Fragmentos</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px;">🎯</div>
                                <div>${gameData.currentPlayer.statPoints}</div>
                                <div style="font-size: 12px; color: #ccc;">Pontos de Atributo</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px;">🏆</div>
                                <div>${gameData.currentPlayer.raidTokens || 0}</div>
                                <div style="font-size: 12px; color: #ccc;">Tokens de Raid</div>
                            </div>
                        </div>
                    </div>

                    <!-- Akuma no Mi -->
                    <div style="background: rgba(255,68,68,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ff4444; margin-bottom: 15px;">
                        <h3>🍎 Akuma no Mi (${devilFruits.length})</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                            ${devilFruits.length > 0 ? devilFruits.map(fruit => `
                                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="useInventoryItem('${fruit.id}', 'devilFruit')">
                                    <div style="font-size: 30px; margin-bottom: 5px;">${fruit.emoji}</div>
                                    <div style="font-size: 12px; font-weight: bold;">${fruit.name}</div>
                                    <div style="font-size: 10px; color: ${fruit.rarity === 'Common' ? '#ccc' : fruit.rarity === 'Rare' ? '#4ade80' : fruit.rarity === 'Legendary' ? '#8b5cf6' : '#ff4444'};">${fruit.rarity}</div>
                                    <button class="btn" style="font-size: 10px; padding: 4px 8px; margin-top: 5px;">⚡ Equipar</button>
                                </div>
                            `).join('') : '<div style="text-align: center; color: #ccc; grid-column: 1/-1;">Nenhuma fruta no inventário</div>'}
                        </div>
                    </div>

                    <!-- Armas -->
                    <div style="background: rgba(139,92,246,0.1); padding: 15px; border-radius: 10px; border: 1px solid #8b5cf6; margin-bottom: 15px;">
                        <h3>⚔️ Armas (${weapons.length})</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                            ${weapons.length > 0 ? weapons.map(weapon => `
                                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="useInventoryItem('${weapon.id}', 'weapon')">
                                    <div style="font-size: 30px; margin-bottom: 5px;">${weapon.emoji}</div>
                                    <div style="font-size: 12px; font-weight: bold;">${weapon.name}</div>
                                    <div style="font-size: 10px; color: #ccc;">Dano: ${weapon.damage}</div>
                                    <button class="btn" style="font-size: 10px; padding: 4px 8px; margin-top: 5px;">⚔️ Equipar</button>
                                </div>
                            `).join('') : '<div style="text-align: center; color: #ccc; grid-column: 1/-1;">Nenhuma arma no inventário</div>'}
                        </div>
                    </div>

                    <!-- Consumíveis -->
                    <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 1px solid #4ade80; margin-bottom: 15px;">
                        <h3>💊 Consumíveis (${consumables.length})</h3>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px;">
                            ${consumables.length > 0 ? consumables.map(item => `
                                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="useInventoryItem('${item.id}', 'consumable', ${item.quantity})">
                                    <div style="font-size: 25px; margin-bottom: 5px;">${item.emoji}</div>
                                    <div style="font-size: 11px; font-weight: bold;">${item.name}</div>
                                    <div style="font-size: 10px; color: #4ade80;">x${item.quantity}</div>
                                    <button class="btn" style="font-size: 9px; padding: 3px 6px; margin-top: 5px;">✨ Usar</button>
                                </div>
                            `).join('') : '<div style="text-align: center; color: #ccc; grid-column: 1/-1;">Nenhum consumível no inventário</div>'}
                        </div>
                    </div>

                    <!-- Materiais -->
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700;">
                        <h3>🔧 Materiais de Craft (${materials.length})</h3>
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 10px;">
                            ${materials.length > 0 ? materials.map(material => `
                                <div style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 20px; margin-bottom: 3px;">${material.emoji}</div>
                                    <div style="font-size: 10px; font-weight: bold;">${material.name}</div>
                                    <div style="font-size: 9px; color: #ffd700;">x${material.quantity}</div>
                                </div>
                            `).join('') : '<div style="text-align: center; color: #ccc; grid-column: 1/-1;">Nenhum material coletado</div>'}
                        </div>
                    </div>

                    <!-- Ações do Inventário -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                        <button class="btn" onclick="organizeInventory()">📦 Organizar Inventário</button>
                        <button class="btn btn-danger" onclick="sellJunkItems()">💰 Vender Itens Inúteis</button>
                    </div>
                </div>
            `);
        }

        function openStats() {
            showModal(`
                <h2>📊 Distribuir Atributos</h2>
                <div style="margin-top: 20px;">
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700; margin-bottom: 15px; text-align: center;">
                        <h3>Pontos Disponíveis: <span style="color: #ffd700;">${gameData.currentPlayer.statPoints}</span></h3>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold;">🗡️ Melee: ${gameData.currentPlayer.stats.melee}</div>
                                <div style="font-size: 12px; color: #ccc;">Aumenta dano corpo a corpo</div>
                            </div>
                            <button class="btn" onclick="addStat('melee')" ${gameData.currentPlayer.statPoints <= 0 ? 'disabled' : ''}>+1</button>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold;">🍎 Devil Fruit: ${gameData.currentPlayer.stats.devilFruit}</div>
                                <div style="font-size: 12px; color: #ccc;">Aumenta poder da Akuma no Mi</div>
                            </div>
                            <button class="btn" onclick="addStat('devilFruit')" ${gameData.currentPlayer.statPoints <= 0 ? 'disabled' : ''}>+1</button>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold;">⚔️ Sword: ${gameData.currentPlayer.stats.sword}</div>
                                <div style="font-size: 12px; color: #ccc;">Aumenta dano de espadas</div>
                            </div>
                            <button class="btn" onclick="addStat('sword')" ${gameData.currentPlayer.statPoints <= 0 ? 'disabled' : ''}>+1</button>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold;">🔫 Gun: ${gameData.currentPlayer.stats.gun}</div>
                                <div style="font-size: 12px; color: #ccc;">Aumenta dano de armas de fogo</div>
                            </div>
                            <button class="btn" onclick="addStat('gun')" ${gameData.currentPlayer.statPoints <= 0 ? 'disabled' : ''}>+1</button>
                        </div>
                    </div>
                </div>
            `);
        }

        function openMultiplayer() {
            showModal(`
                <h2>👥 Multiplayer</h2>
                <div style="margin-top: 20px;">
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid #ffd700; margin-bottom: 15px; text-align: center;">
                        <h3 style="color: #ff4444;">🔴 Modo Offline</h3>
                        <p style="color: #ccc;">Configure um servidor para jogar com amigos</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="action-card" onclick="showServerSetup()">
                            <div style="font-size: 30px; margin-bottom: 10px;">🖥️</div>
                            <h4>Configurar Servidor</h4>
                            <p style="font-size: 12px;">Instruções para multiplayer</p>
                        </div>
                        
                        <div class="action-card" onclick="connectToServer()">
                            <div style="font-size: 30px; margin-bottom: 10px;">🔌</div>
                            <h4>Conectar</h4>
                            <p style="font-size: 12px;">Entrar em servidor</p>
                        </div>
                        
                        <div class="action-card" onclick="showPvPModes()">
                            <div style="font-size: 30px; margin-bottom: 10px;">⚔️</div>
                            <h4>PvP Arena</h4>
                            <p style="font-size: 12px;">Batalhas entre jogadores</p>
                        </div>
                        
                        <div class="action-card" onclick="showCrewSystem()">
                            <div style="font-size: 30px; margin-bottom: 10px;">🏴‍☠️</div>
                            <h4>Sistema de Crews</h4>
                            <p style="font-size: 12px;">Formar tripulações</p>
                        </div>
                    </div>
                </div>
            `);
        }

        // Funções auxiliares
        function buyItem(item, price) {
            if (gameData.currentPlayer.berries >= price) {
                gameData.currentPlayer.berries -= price;
                
                if (item === 'sword') {
                    gameData.currentPlayer.weapon = 'sword';
                    showNotification('⚔️ Espada Katana adquirida!');
                } else if (item === 'gun') {
                    gameData.currentPlayer.weapon = 'gun';
                    showNotification('🔫 Pistola adquirida!');
                } else if (item === 'healthPotion') {
                    gameData.currentPlayer.hp = Math.min(gameData.currentPlayer.maxHp, gameData.currentPlayer.hp + 50);
                    showNotification('💊 +50 HP restaurado!');
                } else if (item === 'energyPotion') {
                    gameData.currentPlayer.energy = Math.min(gameData.currentPlayer.maxEnergy, gameData.currentPlayer.energy + 30);
                    showNotification('⚡ +30 Energia restaurada!');
                }
                
                updateUI();
                updateEquipmentDisplay();
                closeModal();
            } else {
                showNotification('❌ Berries insuficientes!');
            }
        }

        function addStat(statName) {
            if (gameData.currentPlayer.statPoints > 0) {
                gameData.currentPlayer.stats[statName]++;
                gameData.currentPlayer.statPoints--;
                updateUI();
                openStats(); // Recarregar modal
                showNotification(`📈 ${statName} aumentado!`);
            }
        }



        function refreshEnemies() {
            // Gerar novos inimigos aleatórios
            const enemyTypes = [
                { name: 'Bandido', emoji: '🔪', baseLevel: 1 },
                { name: 'Pirata', emoji: '🏴‍☠️', baseLevel: 2 },
                { name: 'Marinheiro', emoji: '⚓', baseLevel: 3 },
                { name: 'Caçador de Recompensas', emoji: '🎯', baseLevel: 4 }
            ];
            
            gameData.enemies = [];
            for (let i = 0; i < 6; i++) {
                const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
                const level = type.baseLevel + Math.floor(Math.random() * 3);
                gameData.enemies.push({
                    id: i + 1,
                    name: type.name,
                    level: level,
                    hp: level * 50,
                    reward: level * 25,
                    emoji: type.emoji
                });
            }
            
            loadEnemies();
            showNotification('🔄 Novos inimigos encontrados!');
        }

        // Sistema de Modal
        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('gameModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('gameModal').style.display = 'none';
        }

        // Funções de multiplayer (simplificadas)
        function showServerSetup() {
            showModal(`
                <h2>🖥️ GUIA COMPLETO: Como Criar Multiplayer</h2>
                <div style="margin-top: 20px; max-height: 70vh; overflow-y: auto;">
                    
                    <!-- PASSO 1: PREPARAÇÃO -->
                    <div style="background: rgba(76,175,80,0.1); padding: 20px; border-radius: 15px; border: 2px solid #4ade80; margin-bottom: 20px;">
                        <h3 style="color: #4ade80; margin-bottom: 15px;">📋 PASSO 1: Preparação do Ambiente</h3>
                        <div style="text-align: left; color: #ccc; line-height: 1.6; font-size: 14px;">
                            <p><strong>1.1 Instalar Node.js:</strong></p>
                            <p style="margin-left: 20px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; font-family: monospace;">
                                • Acesse: https://nodejs.org<br>
                                • Baixe a versão LTS (Long Term Support)<br>
                                • Execute o instalador e siga as instruções
                            </p>
                            
                            <p style="margin-top: 15px;"><strong>1.2 Verificar Instalação:</strong></p>
                            <p style="margin-left: 20px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; font-family: monospace;">
                                node --version<br>
                                npm --version
                            </p>
                        </div>
                    </div>

                    <!-- PASSO 2: SERVIDOR -->
                    <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 2px solid #ffd700; margin-bottom: 20px;">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">🖥️ PASSO 2: Criar o Servidor</h3>
                        <div style="text-align: left; color: #ccc; line-height: 1.6; font-size: 14px;">
                            <p><strong>2.1 Criar pasta do projeto:</strong></p>
                            <p style="margin-left: 20px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; font-family: monospace;">
                                mkdir blox-fruits-server<br>
                                cd blox-fruits-server<br>
                                npm init -y
                            </p>
                            
                            <p style="margin-top: 15px;"><strong>2.2 Instalar dependências:</strong></p>
                            <p style="margin-left: 20px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; font-family: monospace;">
                                npm install express socket.io cors
                            </p>
                            
                            <p style="margin-top: 15px;"><strong>2.3 Criar server.js:</strong></p>
                            <div style="margin-left: 20px; background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; font-family: monospace; font-size: 12px; overflow-x: auto;">
const express = require('express');<br>
const http = require('http');<br>
const socketIo = require('socket.io');<br>
const cors = require('cors');<br><br>

const app = express();<br>
const server = http.createServer(app);<br>
const io = socketIo(server, {<br>
&nbsp;&nbsp;cors: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;origin: "*",<br>
&nbsp;&nbsp;&nbsp;&nbsp;methods: ["GET", "POST"]<br>
&nbsp;&nbsp;}<br>
});<br><br>

app.use(cors());<br>
app.use(express.static('public'));<br><br>

// Salas ativas<br>
const rooms = new Map();<br><br>

io.on('connection', (socket) => {<br>
&nbsp;&nbsp;console.log('Jogador conectado:', socket.id);<br><br>

&nbsp;&nbsp;// Criar sala<br>
&nbsp;&nbsp;socket.on('createRoom', (data) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;const roomCode = 'ROOM_' + Math.random().toString(36).substr(2, 6).toUpperCase();<br>
&nbsp;&nbsp;&nbsp;&nbsp;rooms.set(roomCode, {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;players: [socket.id],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admin: socket.id,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gameState: {}<br>
&nbsp;&nbsp;&nbsp;&nbsp;});<br>
&nbsp;&nbsp;&nbsp;&nbsp;socket.join(roomCode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;socket.emit('roomCreated', { roomCode });<br>
&nbsp;&nbsp;});<br><br>

&nbsp;&nbsp;// Entrar na sala<br>
&nbsp;&nbsp;socket.on('joinRoom', (data) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;const room = rooms.get(data.roomCode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (room) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;room.players.push(socket.id);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket.join(data.roomCode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket.emit('joinedRoom', { roomCode: data.roomCode });<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.to(data.roomCode).emit('playerJoined', { playerId: socket.id });<br>
&nbsp;&nbsp;&nbsp;&nbsp;} else {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket.emit('error', { message: 'Sala não encontrada' });<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;});<br><br>

&nbsp;&nbsp;// Sincronizar dados do jogo<br>
&nbsp;&nbsp;socket.on('gameUpdate', (data) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;socket.to(data.roomCode).emit('gameUpdate', data);<br>
&nbsp;&nbsp;});<br><br>

&nbsp;&nbsp;socket.on('disconnect', () => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;console.log('Jogador desconectado:', socket.id);<br>
&nbsp;&nbsp;});<br>
});<br><br>

const PORT = process.env.PORT || 3000;<br>
server.listen(PORT, () => {<br>
&nbsp;&nbsp;console.log(\`Servidor rodando na porta \${PORT}\`);<br>
});
                            </div>
                        </div>
                    </div>

                    <!-- PASSO 3: CLIENTE -->
                    <div style="background: rgba(139,92,246,0.1); padding: 20px; border-radius: 15px; border: 2px solid #8b5cf6; margin-bottom: 20px;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">💻 PASSO 3: Integrar no Cliente</h3>
                        <div style="text-align: left; color: #ccc; line-height: 1.6; font-size: 14px;">
                            <p><strong>3.1 Adicionar Socket.IO no HTML:</strong></p>
                            <div style="margin-left: 20px; background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; font-family: monospace; font-size: 12px;">
&lt;script src="https://cdn.socket.io/4.7.2/socket.io.min.js"&gt;&lt;/script&gt;
                            </div>
                            
                            <p style="margin-top: 15px;"><strong>3.2 Conectar ao servidor:</strong></p>
                            <div style="margin-left: 20px; background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; font-family: monospace; font-size: 12px;">
// Conectar ao servidor<br>
const socket = io('http://localhost:3000');<br><br>

// Criar sala (apenas admins)<br>
function createMultiplayerRoom() {<br>
&nbsp;&nbsp;socket.emit('createRoom', { adminId: currentUser.username });<br>
}<br><br>

// Entrar na sala<br>
function joinMultiplayerRoom(roomCode) {<br>
&nbsp;&nbsp;socket.emit('joinRoom', { roomCode });<br>
}<br><br>

// Escutar eventos<br>
socket.on('roomCreated', (data) => {<br>
&nbsp;&nbsp;console.log('Sala criada:', data.roomCode);<br>
});<br><br>

socket.on('joinedRoom', (data) => {<br>
&nbsp;&nbsp;console.log('Entrou na sala:', data.roomCode);<br>
});<br><br>

socket.on('gameUpdate', (data) => {<br>
&nbsp;&nbsp;// Sincronizar dados do jogo<br>
&nbsp;&nbsp;updateGameState(data);<br>
});
                            </div>
                        </div>
                    </div>

                    <!-- PASSO 4: EXECUTAR -->
                    <div style="background: rgba(255,68,68,0.1); padding: 20px; border-radius: 15px; border: 2px solid #ff4444; margin-bottom: 20px;">
                        <h3 style="color: #ff4444; margin-bottom: 15px;">🚀 PASSO 4: Executar o Servidor</h3>
                        <div style="text-align: left; color: #ccc; line-height: 1.6; font-size: 14px;">
                            <p><strong>4.1 Iniciar servidor:</strong></p>
                            <p style="margin-left: 20px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; font-family: monospace;">
                                node server.js
                            </p>
                            
                            <p style="margin-top: 15px;"><strong>4.2 Testar conexão:</strong></p>
                            <p style="margin-left: 20px;">• Abra http://localhost:3000 no navegador</p>
                            <p style="margin-left: 20px;">• Teste criar e entrar em salas</p>
                            
                            <p style="margin-top: 15px;"><strong>4.3 Compartilhar com amigos:</strong></p>
                            <p style="margin-left: 20px;">• Descubra seu IP: ipconfig (Windows) ou ifconfig (Mac/Linux)</p>
                            <p style="margin-left: 20px;">• Amigos acessam: http://SEU_IP:3000</p>
                            <p style="margin-left: 20px;">• Configure firewall se necessário</p>
                        </div>
                    </div>

                    <!-- RECURSOS AVANÇADOS -->
                    <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 2px solid #ffd700;">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">⚡ Recursos Avançados</h3>
                        <div style="text-align: left; color: #ccc; line-height: 1.6; font-size: 14px;">
                            <p><strong>• Sincronização de Batalhas:</strong> Compartilhar estado de combate em tempo real</p>
                            <p><strong>• Chat Global:</strong> Sistema de mensagens entre jogadores</p>
                            <p><strong>• PvP Arena:</strong> Batalhas diretas entre jogadores</p>
                            <p><strong>• Sistema de Crews:</strong> Formar grupos e guildas</p>
                            <p><strong>• Eventos Globais:</strong> Raids e eventos para todos os jogadores</p>
                            <p><strong>• Ranking Global:</strong> Leaderboards de níveis e recompensas</p>
                        </div>
                    </div>
                </div>
            `);
        }

        function connectToServer() {
            showNotification('🔄 Tentando conectar... (Demo - servidor não configurado)');
        }

        function showPvPModes() {
            showNotification('⚔️ Modos PvP disponíveis após conectar ao servidor!');
        }

        function showCrewSystem() {
            showNotification('🏴‍☠️ Sistema de Crews disponível no multiplayer!');
        }

        // Sistema Spin Fruits
        const spinFruits = {
            gomu: { name: 'Gomu Gomu no Mi', rarity: 'Common', emoji: '🤜', chance: 25 },
            bomb: { name: 'Bomb Bomb no Mi', rarity: 'Common', emoji: '💣', chance: 20 },
            suna: { name: 'Suna Suna no Mi', rarity: 'Common', emoji: '🏜️', chance: 15 },
            mera: { name: 'Mera Mera no Mi', rarity: 'Rare', emoji: '🔥', chance: 15 },
            hie: { name: 'Hie Hie no Mi', rarity: 'Rare', emoji: '❄️', chance: 10 },
            goro: { name: 'Goro Goro no Mi', rarity: 'Legendary', emoji: '⚡', chance: 8 },
            yami: { name: 'Yami Yami no Mi', rarity: 'Legendary', emoji: '🌑', chance: 4 },
            pika: { name: 'Pika Pika no Mi', rarity: 'Mythical', emoji: '💡', chance: 2 },
            doku: { name: 'Doku Doku no Mi', rarity: 'Mythical', emoji: '☠️', chance: 1 },
            magu: { name: 'Magu Magu no Mi', rarity: 'Mythical', emoji: '🌋', chance: 0.5 }
        };

        function openSpinFruits() {
            showModal(`
                <h2>🎰 Spin Devil Fruits</h2>
                <div style="margin-top: 20px;">
                    <!-- Roda de Spin -->
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div id="spinWheel" style="width: 200px; height: 200px; border: 5px solid #ffd700; border-radius: 50%; margin: 0 auto 20px; background: conic-gradient(#ff4444 0deg 72deg, #ffd700 72deg 144deg, #4ade80 144deg 216deg, #8b5cf6 216deg 288deg, #ff4444 288deg 360deg); display: flex; align-items: center; justify-content: center; font-size: 40px; transition: transform 3s ease-out;">
                            🎰
                        </div>
                        <div id="spinResult" style="font-size: 18px; font-weight: bold; margin-bottom: 20px; min-height: 25px;"></div>
                    </div>

                    <!-- Opções de Spin -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 2px solid #ffd700; text-align: center;">
                            <h3 style="color: #ffd700; margin-bottom: 15px;">💰 Spin Normal</h3>
                            <p style="color: #ccc; margin-bottom: 15px;">Custo: 2,500 Berries</p>
                            <p style="font-size: 12px; color: #ccc; margin-bottom: 15px;">Chances normais de frutas raras</p>
                            <button class="btn" onclick="spinFruit('normal')" ${gameData.currentPlayer.berries < 2500 ? 'disabled style="opacity: 0.5;"' : ''}>
                                🎰 Girar Normal
                            </button>
                        </div>
                        
                        <div style="background: rgba(139,92,246,0.1); padding: 20px; border-radius: 15px; border: 2px solid #8b5cf6; text-align: center;">
                            <h3 style="color: #8b5cf6; margin-bottom: 15px;">⭐ Spin Premium</h3>
                            <p style="color: #ccc; margin-bottom: 15px;">Custo: 100 Fragmentos</p>
                            <p style="font-size: 12px; color: #ccc; margin-bottom: 15px;">2x mais chance de frutas raras!</p>
                            <button class="btn" onclick="spinFruit('premium')" ${gameData.currentPlayer.fragments < 100 ? 'disabled style="opacity: 0.5;"' : ''}>
                                ⭐ Girar Premium
                            </button>
                        </div>
                    </div>

                    <!-- Tabela de Chances -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #ffd700; margin-bottom: 15px; text-align: center;">📊 Chances de Drop</h4>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; font-size: 12px;">
                            <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                                <div style="color: #ccc;">Common</div>
                                <div style="color: #ffd700;">60%</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: rgba(76,175,80,0.2); border-radius: 5px;">
                                <div style="color: #4ade80;">Rare</div>
                                <div style="color: #ffd700;">25%</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: rgba(139,92,246,0.2); border-radius: 5px;">
                                <div style="color: #8b5cf6;">Legendary</div>
                                <div style="color: #ffd700;">12%</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: rgba(255,68,68,0.2); border-radius: 5px;">
                                <div style="color: #ff4444;">Mythical</div>
                                <div style="color: #ffd700;">3%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recursos do Jogador -->
                    <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 10px; border: 1px solid #4ade80; text-align: center;">
                        <h4 style="color: #4ade80; margin-bottom: 10px;">💰 Seus Recursos</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <div style="font-size: 20px;">💰</div>
                                <div style="font-weight: bold;">${gameData.currentPlayer.berries.toLocaleString()}</div>
                                <div style="font-size: 12px; color: #ccc;">Berries</div>
                            </div>
                            <div>
                                <div style="font-size: 20px;">⭐</div>
                                <div style="font-weight: bold;">${gameData.currentPlayer.fragments.toLocaleString()}</div>
                                <div style="font-size: 12px; color: #ccc;">Fragmentos</div>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        function spinFruit(type) {
            const cost = type === 'normal' ? 2500 : 100;
            const currency = type === 'normal' ? 'berries' : 'fragments';
            
            if (gameData.currentPlayer[currency] < cost) {
                showNotification(`❌ ${currency === 'berries' ? 'Berries' : 'Fragmentos'} insuficientes!`);
                return;
            }
            
            // Consumir recursos
            gameData.currentPlayer[currency] -= cost;
            
            // Calcular fruta baseado nas chances
            const multiplier = type === 'premium' ? 2 : 1;
            const result = getRandomFruit(multiplier);
            
            // Animação da roda
            const wheel = document.getElementById('spinWheel');
            const spins = 5 + Math.random() * 3; // 5-8 voltas
            wheel.style.transform = `rotate(${spins * 360}deg)`;
            
            // Desabilitar botões durante spin
            const buttons = document.querySelectorAll('#gameModal button');
            buttons.forEach(btn => btn.disabled = true);
            
            setTimeout(() => {
                // Mostrar resultado
                const fruit = spinFruits[result];
                const rarityColors = {
                    'Common': '#ccc',
                    'Rare': '#4ade80', 
                    'Legendary': '#8b5cf6',
                    'Mythical': '#ff4444'
                };
                
                document.getElementById('spinResult').innerHTML = `
                    <div style="color: ${rarityColors[fruit.rarity]};">
                        ${fruit.emoji} ${fruit.name}
                    </div>
                    <div style="font-size: 14px; color: ${rarityColors[fruit.rarity]};">
                        ${fruit.rarity}
                    </div>
                `;
                
                // Reabilitar botões
                buttons.forEach(btn => btn.disabled = false);
                
                // Mostrar opções pós-spin
                setTimeout(() => {
                    showSpinResult(result, fruit);
                }, 1000);
                
            }, 3000);
            
            updateUI();
        }

        function getRandomFruit(multiplier = 1) {
            const random = Math.random() * 100;
            let cumulative = 0;
            
            // Ajustar chances com multiplicador
            const adjustedFruits = Object.entries(spinFruits).map(([key, fruit]) => ({
                key,
                ...fruit,
                adjustedChance: fruit.rarity === 'Common' ? fruit.chance : fruit.chance * multiplier
            }));
            
            // Normalizar chances para 100%
            const totalChance = adjustedFruits.reduce((sum, fruit) => sum + fruit.adjustedChance, 0);
            const normalizedFruits = adjustedFruits.map(fruit => ({
                ...fruit,
                normalizedChance: (fruit.adjustedChance / totalChance) * 100
            }));
            
            for (const fruit of normalizedFruits) {
                cumulative += fruit.normalizedChance;
                if (random <= cumulative) {
                    return fruit.key;
                }
            }
            
            return 'gomu'; // Fallback
        }

        function showSpinResult(fruitKey, fruit) {
            showModal(`
                <h2>🎉 Resultado do Spin!</h2>
                <div style="text-align: center; margin-top: 30px;">
                    <div style="font-size: 80px; margin-bottom: 20px;">${fruit.emoji}</div>
                    <h3 style="color: ${fruit.rarity === 'Common' ? '#ccc' : fruit.rarity === 'Rare' ? '#4ade80' : fruit.rarity === 'Legendary' ? '#8b5cf6' : '#ff4444'}; margin-bottom: 10px;">
                        ${fruit.name}
                    </h3>
                    <div style="font-size: 18px; color: ${fruit.rarity === 'Common' ? '#ccc' : fruit.rarity === 'Rare' ? '#4ade80' : fruit.rarity === 'Legendary' ? '#8b5cf6' : '#ff4444'}; margin-bottom: 30px;">
                        ${fruit.rarity}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <button class="btn btn-success" onclick="equipFruit('${fruitKey}')">
                            ⚡ Equipar Agora
                        </button>
                        <button class="btn" onclick="storeFruit('${fruitKey}')">
                            🎒 Guardar no Inventário
                        </button>
                    </div>
                    
                    <button class="btn" onclick="closeModal(); openSpinFruits();" style="margin-top: 15px; width: 100%;">
                        🎰 Girar Novamente
                    </button>
                </div>
            `);
        }

        function equipFruit(fruitKey) {
            gameData.currentPlayer.devilFruit = fruitKey;
            updateEquipmentDisplay();
            updateUI();
            closeModal();
            showNotification(`🍎 ${spinFruits[fruitKey].name} equipada!`);
        }

        function storeFruit(fruitKey) {
            if (!gameData.currentPlayer.inventory) {
                gameData.currentPlayer.inventory = [];
            }
            gameData.currentPlayer.inventory.push({
                type: 'devilFruit',
                id: fruitKey,
                name: spinFruits[fruitKey].name,
                emoji: spinFruits[fruitKey].emoji,
                rarity: spinFruits[fruitKey].rarity
            });
            closeModal();
            showNotification(`🎒 ${spinFruits[fruitKey].name} guardada no inventário!`);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 4000);
        }

        // Funções do Sistema de Inventário
        function useInventoryItem(itemId, itemType, quantity = 1) {
            const inventory = gameData.currentPlayer.inventory || [];
            const itemIndex = inventory.findIndex(item => item.id === itemId && item.type === itemType);
            
            if (itemIndex === -1) {
                showNotification('❌ Item não encontrado no inventário!');
                return;
            }
            
            const item = inventory[itemIndex];
            
            if (itemType === 'devilFruit') {
                gameData.currentPlayer.devilFruit = itemId;
                inventory.splice(itemIndex, 1);
                updateEquipmentDisplay();
                showNotification(`🍎 ${item.name} equipada!`);
            } else if (itemType === 'weapon') {
                gameData.currentPlayer.weapon = itemId;
                inventory.splice(itemIndex, 1);
                updateEquipmentDisplay();
                showNotification(`⚔️ ${item.name} equipada!`);
            } else if (itemType === 'consumable') {
                if (item.id === 'healthPotion') {
                    gameData.currentPlayer.hp = Math.min(gameData.currentPlayer.maxHp, gameData.currentPlayer.hp + 50);
                    showNotification('💊 +50 HP restaurado!');
                } else if (item.id === 'energyPotion') {
                    gameData.currentPlayer.energy = Math.min(gameData.currentPlayer.maxEnergy, gameData.currentPlayer.energy + 30);
                    showNotification('⚡ +30 Energia restaurada!');
                } else if (item.id === 'expBoost') {
                    gameData.currentPlayer.exp += 200;
                    showNotification('📈 +200 EXP ganho!');
                }
                
                item.quantity--;
                if (item.quantity <= 0) {
                    inventory.splice(itemIndex, 1);
                }
            }
            
            updateUI();
            closeModal();
            setTimeout(() => openInventory(), 100);
        }

        function organizeInventory() {
            if (!gameData.currentPlayer.inventory) {
                gameData.currentPlayer.inventory = [];
            }
            
            // Organizar por tipo e raridade
            gameData.currentPlayer.inventory.sort((a, b) => {
                const typeOrder = { 'devilFruit': 1, 'weapon': 2, 'consumable': 3, 'material': 4 };
                const rarityOrder = { 'Mythical': 1, 'Legendary': 2, 'Rare': 3, 'Common': 4 };
                
                if (a.type !== b.type) {
                    return typeOrder[a.type] - typeOrder[b.type];
                }
                
                if (a.rarity && b.rarity && a.rarity !== b.rarity) {
                    return rarityOrder[a.rarity] - rarityOrder[b.rarity];
                }
                
                return a.name.localeCompare(b.name);
            });
            
            showNotification('📦 Inventário organizado!');
            closeModal();
            setTimeout(() => openInventory(), 100);
        }

        function sellJunkItems() {
            if (!gameData.currentPlayer.inventory) {
                gameData.currentPlayer.inventory = [];
                showNotification('❌ Inventário vazio!');
                return;
            }
            
            const junkItems = gameData.currentPlayer.inventory.filter(item => 
                item.type === 'material' || (item.type === 'consumable' && item.rarity === 'Common')
            );
            
            if (junkItems.length === 0) {
                showNotification('❌ Nenhum item para vender!');
                return;
            }
            
            let totalValue = 0;
            junkItems.forEach(item => {
                const baseValue = item.type === 'material' ? 10 : 50;
                totalValue += baseValue * (item.quantity || 1);
            });
            
            // Remover itens vendidos
            gameData.currentPlayer.inventory = gameData.currentPlayer.inventory.filter(item => 
                !(item.type === 'material' || (item.type === 'consumable' && item.rarity === 'Common'))
            );
            
            gameData.currentPlayer.berries += totalValue;
            updateUI();
            showNotification(`💰 Itens vendidos por ${totalValue.toLocaleString()} Berries!`);
            closeModal();
            setTimeout(() => openInventory(), 100);
        }

        // Funções do Sistema de Raids
        function startRaid(raidType) {
            const raidData = {
                gorilla: { name: 'Gorilla King', emoji: '🦍', hp: 500, damage: 30, cost: 1, level: 5 },
                dragon: { name: 'Sea Dragon', emoji: '🐉', hp: 1200, damage: 50, cost: 2, level: 15 },
                demon: { name: 'Demon Lord', emoji: '👹', hp: 2500, damage: 80, cost: 3, level: 25 },
                emperor: { name: 'Death Emperor', emoji: '💀', hp: 5000, damage: 120, cost: 5, level: 50 }
            };
            
            const raid = raidData[raidType];
            const playerTokens = gameData.currentPlayer.raidTokens || 0;
            
            if (gameData.currentPlayer.level < raid.level) {
                showNotification(`❌ Você precisa ser nível ${raid.level}!`);
                return;
            }
            
            if (playerTokens < raid.cost) {
                showNotification(`❌ Você precisa de ${raid.cost} tokens!`);
                return;
            }
            
            // Consumir tokens
            gameData.currentPlayer.raidTokens = (gameData.currentPlayer.raidTokens || 0) - raid.cost;
            
            // Iniciar raid
            gameData.currentRaid = {
                type: raidType,
                boss: { ...raid, currentHp: raid.hp, maxHp: raid.hp },
                phase: 1,
                maxPhases: 3,
                rewards: []
            };
            
            closeModal();
            showRaidBattle();
        }

        function showRaidBattle() {
            const raid = gameData.currentRaid;
            const boss = raid.boss;
            
            showModal(`
                <h2>🌋 RAID: ${boss.name}</h2>
                <div style="margin-top: 20px;">
                    <!-- Status da Raid -->
                    <div style="background: rgba(255,68,68,0.1); padding: 15px; border-radius: 10px; border: 2px solid #ff4444; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 10px;">${boss.emoji}</div>
                        <h3 style="color: #ff4444; margin-bottom: 10px;">${boss.name}</h3>
                        <div style="font-size: 14px; color: #ffd700; margin-bottom: 15px;">Fase ${raid.phase}/${raid.maxPhases}</div>
                        
                        <!-- HP do Boss -->
                        <div style="margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: #ff4444;">💀 Boss HP</span>
                                <span style="color: #ff4444;">${boss.currentHp}/${boss.maxHp}</span>
                            </div>
                            <div style="background: rgba(255,68,68,0.3); height: 12px; border-radius: 6px; overflow: hidden;">
                                <div style="background: #ff4444; height: 100%; width: ${(boss.currentHp / boss.maxHp) * 100}%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        
                        <!-- HP do Jogador -->
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: #4ade80;">❤️ Seu HP</span>
                                <span style="color: #4ade80;">${gameData.currentPlayer.hp}/${gameData.currentPlayer.maxHp}</span>
                            </div>
                            <div style="background: rgba(76,175,80,0.3); height: 10px; border-radius: 5px; overflow: hidden;">
                                <div style="background: #4ade80; height: 100%; width: ${(gameData.currentPlayer.hp / gameData.currentPlayer.maxHp) * 100}%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Ações de Raid -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                        <button class="btn btn-danger" onclick="raidAttack()">
                            ⚔️ Ataque Poderoso
                        </button>
                        <button class="btn" onclick="raidSpecialAttack()">
                            ⚡ Ataque Especial
                        </button>
                        <button class="btn btn-success" onclick="raidHeal()">
                            💊 Curar (50 HP)
                        </button>
                        <button class="btn btn-danger" onclick="raidFlee()">
                            🏃 Fugir da Raid
                        </button>
                    </div>

                    <!-- Log da Raid -->
                    <div style="background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; max-height: 150px; overflow-y: auto;" id="raidLog">
                        <div style="color: #ffd700; font-weight: bold;">🌋 Raid iniciada contra ${boss.name}!</div>
                        <div style="color: #ccc; font-size: 12px;">Use ataques poderosos para derrotar o boss!</div>
                    </div>
                </div>
            `);
        }

        function raidAttack() {
            const raid = gameData.currentRaid;
            const boss = raid.boss;
            
            // Ataque do jogador
            const playerDamage = Math.floor(Math.random() * 100) + 50;
            boss.currentHp -= playerDamage;
            
            addRaidLog(`⚔️ Você causou ${playerDamage} de dano!`);
            
            if (boss.currentHp <= 0) {
                boss.currentHp = 0;
                nextRaidPhase();
                return;
            }
            
            // Ataque do boss
            const bossDamage = Math.floor(Math.random() * boss.damage) + 20;
            gameData.currentPlayer.hp -= bossDamage;
            
            addRaidLog(`💥 ${boss.name} causou ${bossDamage} de dano em você!`);
            
            if (gameData.currentPlayer.hp <= 0) {
                gameData.currentPlayer.hp = 0;
                raidDefeat();
                return;
            }
            
            updateRaidInterface();
        }

        function raidSpecialAttack() {
            const raid = gameData.currentRaid;
            const boss = raid.boss;
            
            if (gameData.currentPlayer.energy < 30) {
                addRaidLog('❌ Energia insuficiente para ataque especial!');
                return;
            }
            
            gameData.currentPlayer.energy -= 30;
            
            const specialDamage = Math.floor(Math.random() * 150) + 100;
            boss.currentHp -= specialDamage;
            
            addRaidLog(`⚡ ATAQUE ESPECIAL! Você causou ${specialDamage} de dano!`);
            
            if (boss.currentHp <= 0) {
                boss.currentHp = 0;
                nextRaidPhase();
                return;
            }
            
            // Boss contra-ataca mais forte
            const counterDamage = Math.floor(Math.random() * boss.damage * 1.5) + 30;
            gameData.currentPlayer.hp -= counterDamage;
            
            addRaidLog(`💢 ${boss.name} contra-atacou com ${counterDamage} de dano!`);
            
            if (gameData.currentPlayer.hp <= 0) {
                gameData.currentPlayer.hp = 0;
                raidDefeat();
                return;
            }
            
            updateRaidInterface();
        }

        function raidHeal() {
            const healAmount = 50;
            gameData.currentPlayer.hp = Math.min(gameData.currentPlayer.maxHp, gameData.currentPlayer.hp + healAmount);
            
            addRaidLog(`💊 Você se curou em ${healAmount} HP!`);
            
            // Boss aproveita para atacar
            const bossDamage = Math.floor(Math.random() * boss.damage) + 15;
            gameData.currentPlayer.hp -= bossDamage;
            
            addRaidLog(`💥 ${gameData.currentRaid.boss.name} aproveitou e atacou por ${bossDamage} de dano!`);
            
            updateRaidInterface();
        }

        function nextRaidPhase() {
            const raid = gameData.currentRaid;
            
            if (raid.phase >= raid.maxPhases) {
                raidVictory();
                return;
            }
            
            raid.phase++;
            raid.boss.currentHp = raid.boss.maxHp;
            raid.boss.damage = Math.floor(raid.boss.damage * 1.2);
            
            addRaidLog(`🌟 FASE ${raid.phase} INICIADA! O boss ficou mais forte!`);
            updateRaidInterface();
        }

        function raidVictory() {
            const raid = gameData.currentRaid;
            const raidType = raid.type;
            
            // Calcular recompensas
            const rewards = {
                gorilla: { berries: [1000, 2000], fragments: [50, 100], items: ['healthPotion', 'energyPotion'] },
                dragon: { berries: [3000, 5000], fragments: [100, 200], items: ['rareWeapon', 'expBoost'] },
                demon: { berries: [5000, 10000], fragments: [200, 400], items: ['legendaryFruit', 'rareWeapon'] },
                emperor: { berries: [10000, 20000], fragments: [500, 1000], items: ['mythicalFruit', 'legendaryWeapon'] }
            };
            
            const reward = rewards[raidType];
            const berriesGain = Math.floor(Math.random() * (reward.berries[1] - reward.berries[0])) + reward.berries[0];
            const fragmentsGain = Math.floor(Math.random() * (reward.fragments[1] - reward.fragments[0])) + reward.fragments[0];
            
            gameData.currentPlayer.berries += berriesGain;
            gameData.currentPlayer.fragments += fragmentsGain;
            gameData.currentPlayer.raidsCompleted = (gameData.currentPlayer.raidsCompleted || 0) + 1;
            gameData.currentPlayer.raidTokens = (gameData.currentPlayer.raidTokens || 0) + 1; // Bonus token
            
            // Chance de item especial
            if (Math.random() < 0.7) {
                const specialItem = reward.items[Math.floor(Math.random() * reward.items.length)];
                addItemToInventory(specialItem);
            }
            
            addRaidLog(`🎉 VITÓRIA! +${berriesGain} Berries, +${fragmentsGain} Fragmentos!`);
            addRaidLog(`🏆 +1 Token de Raid como bônus!`);
            
            gameData.currentRaid = null;
            updateUI();
            
            setTimeout(() => {
                showNotification(`🌋 Raid completa! Recompensas recebidas!`);
                closeModal();
            }, 2000);
        }

        function raidDefeat() {
            addRaidLog(`💀 DERROTA! Você foi derrotado pelo boss...`);
            
            gameData.currentPlayer.hp = gameData.currentPlayer.maxHp;
            gameData.currentPlayer.energy = gameData.currentPlayer.maxEnergy;
            gameData.currentRaid = null;
            
            setTimeout(() => {
                showNotification('💀 Você foi derrotado na raid!');
                closeModal();
            }, 2000);
        }

        function raidFlee() {
            addRaidLog(`🏃 Você fugiu da raid!`);
            
            gameData.currentRaid = null;
            
            setTimeout(() => {
                showNotification('🏃 Você fugiu da raid!');
                closeModal();
            }, 1000);
        }

        function addRaidLog(message) {
            const raidLog = document.getElementById('raidLog');
            if (raidLog) {
                const logDiv = document.createElement('div');
                logDiv.style.cssText = 'margin-bottom: 3px; font-size: 12px; color: #ccc;';
                logDiv.innerHTML = message;
                raidLog.appendChild(logDiv);
                raidLog.scrollTop = raidLog.scrollHeight;
            }
        }

        function updateRaidInterface() {
            showRaidBattle(); // Recarregar interface
        }

        function buyRaidToken() {
            if (gameData.currentPlayer.berries >= 5000) {
                gameData.currentPlayer.berries -= 5000;
                gameData.currentPlayer.raidTokens = (gameData.currentPlayer.raidTokens || 0) + 1;
                updateUI();
                showNotification('🏆 Token de Raid comprado!');
                closeModal();
                setTimeout(() => openRaids(), 100);
            } else {
                showNotification('❌ Berries insuficientes!');
            }
        }

        function addItemToInventory(itemId) {
            if (!gameData.currentPlayer.inventory) {
                gameData.currentPlayer.inventory = [];
            }
            
            const items = {
                healthPotion: { name: 'Poção de Vida', emoji: '💊', type: 'consumable', rarity: 'Common', quantity: 3 },
                energyPotion: { name: 'Poção de Energia', emoji: '⚡', type: 'consumable', rarity: 'Common', quantity: 2 },
                expBoost: { name: 'Boost de EXP', emoji: '📈', type: 'consumable', rarity: 'Rare', quantity: 1 },
                rareWeapon: { name: 'Espada Rara', emoji: '⚔️', type: 'weapon', rarity: 'Rare', damage: 45 },
                legendaryWeapon: { name: 'Espada Lendária', emoji: '🗡️', type: 'weapon', rarity: 'Legendary', damage: 80 },
                legendaryFruit: { name: 'Fruta Lendária', emoji: '🍎', type: 'devilFruit', rarity: 'Legendary' },
                mythicalFruit: { name: 'Fruta Mítica', emoji: '🌟', type: 'devilFruit', rarity: 'Mythical' }
            };
            
            const item = items[itemId];
            if (item) {
                gameData.currentPlayer.inventory.push({ id: itemId, ...item });
                addRaidLog(`🎁 Item obtido: ${item.emoji} ${item.name}!`);
            }
        }

        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar usuários salvos
            users = JSON.parse(localStorage.getItem('bloxFruitsUsers')) || {};
            
            // Inicializar tokens de raid se não existir
            if (!gameData.currentPlayer.raidTokens) {
                gameData.currentPlayer.raidTokens = 2; // Começar com 2 tokens
            }
            
            // Mostrar tela de login
            showLoginScreen();
        });

        // Fechar modal clicando fora
        document.getElementById('gameModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Permitir Enter nos formulários
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('loginForm').style.display !== 'none') {
                    login();
                } else if (document.getElementById('signupForm').style.display !== 'none') {
                    signup();
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9800f43ee2f1240e',t:'MTc1ODAzMTg5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

